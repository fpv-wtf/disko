
SRC=$(shell find . -name '*.cpp')
OBJ=$(SRC:%.cpp=%.o)

all: $(OBJ)
	@mkdir -p $(OUTPUTDIR)
	@echo " [LD]        ($(TARGET))"
	@$(CXX) $(LDFLAGS) -o $(OUTPUTDIR)/$(TARGET) $(OBJ) $(LOCAL_LIBS) $(LIBS)

clean:
	@echo " Cleaning $(TARGET)"
	@rm -f $(OBJ)
	@rm -f $(OUTPUTDIR)/$(TARGET)
	
install: all
	@echo " [INSTALL]   ($(TARGET))"
	@install -d $(DESTDIR)$(bindir)
	@install -c -m 755 $(OUTPUTDIR)/$(TARGET) $(DESTDIR)$(bindir)/
	@if test -d ./share/; then \
		pushd share &> /dev/null; \
		for i in `find . -type f | grep -v /CVS/`; do \
			dir=`dirname $$i`; \
			install -d "$(DESTDIR)$(datadir)/$$dir"; \
			install -c -m 644 "$$i" "$(DESTDIR)$(datadir)/$$dir/"; \
		done; \
		popd &> /dev/null; \
	fi
	@if test -d ./etc/; then \
		pushd etc &> /dev/null; \
		for i in `find . -type f | grep -v /CVS/`; do \
			dir=`dirname $$i`; \
			install -d "$(DESTDIR)$(sysconfdir)/$$dir"; \
			install -c -m 644 "$$i" "$(DESTDIR)$(sysconfdir)/$$dir/"; \
		done; \
		popd &> /dev/null; \
	fi
	@if test -n "$(LOCAL_BINFILES)"; then \
		install -c -m 755 $(LOCAL_BINFILES) $(DESTDIR)$(bindir)/; \
	fi
	@$(LOCAL_INSTALLSCRIPT)

update: all
	@install -c -m 755 $(OUTPUTDIR)/$(TARGET) $(DESTDIR)$(bindir)/
	@if test -d ./share/; then \
		pushd share &> /dev/null; \
		for i in `find . -type f | grep -v /CVS/`; do \
			dir=`dirname $$i`; \
			install -d "$(DESTDIR)$(datadir)/$$dir"; \
			install -c -m 644 "$$i" "$(DESTDIR)$(datadir)/$$dir/"; \
		done; \
		popd &> /dev/null; \
	fi;
	
%.o : %.cpp
	@echo " (CXX)        ($@)"
	@$(CXX) $(CFLAGS) $(INC) $(LOCAL_INC) -c $< -o $@

