<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb" dir="ltr" >
<head>
	<link rel="stylesheet" href="/templates/diskohq/css/template.css" type="text/css" />


	  <base href="/developers/documentation/howtos/layersandwindows.html" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="robots" content="index, follow" />
  <meta name="keywords" content="Disko, Disko framework, documentation, layers, windows, framebuffer" />
  <meta name="description" content="Disko a linux application framework for embedded devices" />
  <meta name="generator" content="Joomla! 1.5 - Open Source Content Management" />
  <title>Disko Framework - Documentation - Working With Layers and Windows</title>
  <link href="/templates/diskohq/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <link rel="stylesheet" href="/templates/diskohq/css/documentation.css" type="text/css" />
  <style type="text/css">
    <!--

	@import url(http://www.google.com/cse/api/overlay.css);
	.cse-overlay {
		position: absolute;
		z-index:99;
	}
	body > .cse-overlay {
		display: none;
	}
	body > .cse-overlay:first-child {
		display: block;
	}
	.cse-overlay-bg {
		z-index: 98;
		opacity: 0.5;
	}
	.cse-resultsContainer a:hover {
		color: #000;
	}
	.cse-resultsContainer .gs-snippet {
		color: #777;
	}
	.cse-resultsContainer  .gs-visibleUrl {
		font-size: 80%;
	}
    -->
  </style>

	
	<script type="text/javascript" src="/includes/js/jQuery/jquery-1.4.1.min.js"></script>
	

    <script type="text/javascript" src="/includes/js/wz_tooltip/wz_tooltip.js"></script>
    <script type="text/javascript">
    <!--
    jQuery(function() {
      tt_Init(); // init wz_tooltips. Has to be called in this function due to a bug in IE7
    });
    -->
    </script>


	<script type="text/javascript">
		<!--
		
		jQuery.noConflict();
		
		/* IE 6 detection */
		function redirectIE6() {
			if(typeof(navigator) != "undefined") {
				if(navigator.appName == 'Microsoft Internet Explorer') {
					if(navigator.appVersion.indexOf('MSIE 6') > -1) {
						window.location = '/ie6.html';
					}
				}
			}
		}
		redirectIE6();

		function repositionMenu() {
			var menuDiv = document.getElementById('mainmenu');
			var ul0 = menuDiv.getElementsByTagName('ul')[0];
	
			if(ul0) {
				var div  = document.createElement('div');
				var divA = document.createElement('div');
				var divB = document.createElement('div');
	
				var id   = document.createAttribute('id');
				var idA  = document.createAttribute('id');
				var idB  = document.createAttribute('id');
	
				var ul1    = ul0.getElementsByTagName('ul')[0];
	
				id.nodeValue  = 'subMenuDiv';
				idA.nodeValue = 'subMenuDiv-lvl1';
				idB.nodeValue = 'subMenuDiv-lvl2';
	
				div.setAttributeNode(id);
				divA.setAttributeNode(idA);
				divB.setAttributeNode(idB);
	
				if(ul1) {
					divA.appendChild(ul1);
					var ul2 = ul1.getElementsByTagName('ul')[0];
					if(ul2) {
						divB.appendChild(ul2);
					}
				}
	
				div.appendChild(divA);
				div.appendChild(divB);
				
				menuDiv.appendChild(div);
			}
		}


		function redrawHeadline() {
						var headlines = jQuery('#documentationContent h2');
						for(i = 0; i < headlines.length; ++i) {
								headlines[i].firstChild.insertData(0, '– ');
							}
		}
		function showFull(id) {
			var l = document.getElementById('system-readmore-position' + id);

			

			jQuery('#fullContent' + id).slideToggle('slow', function () {
				l.firstChild.nodeValue = jQuery('#fullContent' + id + ':visible').length ? 'hide' : 'more';
			});
		}

		-->
	</script>
</head>
<body>
	<div id="all">
		<div id="header">
				<div class="speakBubble" style="position: absolute; left: 760px; top: 20px; padding: 12px 0 0 0;">
					<a target="_blank" href="https://github.com/fpv-wtf/disko">This is a <br/> mirror!</a>
				</div>
			<div id="logo">
				<a href="/"><img id="disko-logo" src="/templates/diskohq/images/disko-logo.png" alt="disko"/></a>
			</div>
			<div id="topmenu">

				<ul class="menu"><li class="item3"><a href="/contact"><span>Contact</span></a></li><li class="item6"><span class="separator"><span>  |  </span></span></li><li class="item4"><a href="/impressum"><span>Impressum</span></a></li></ul><br/>
				<a target="twitter.com" href="http://twitter.com/diskoFramework"><img style="margin-top: 2px;float: right" src="/templates/diskohq/images/twitter-c.png" alt="Twitter"/></a>
			</div>
		</div><!-- end header -->
		<div id="mainmenu">
			<ul class="menu"><li class="item1"><a href="/"><span>Home</span></a></li><li class="parent item7"><a href="/products/disko-framework/overview"><span>Products</span></a></li><li class="parent active item8"><a href="/developers/documentation/installation/ubuntu.html"><span>Developers</span></a><ul><li id="current" class="active item15"><a href="/developers/documentation/installation/ubuntu.html"><span>Documentation</span></a></li><li class="parent item16"><a href="/developers/downloads/disko"><span>Downloads</span></a></li></ul></li><li class="item24"><a href="/forum"><span>Forum</span></a></li><li class="item25"><a href="http://www.youtube.com/user/DiskoFramework" target="_blank"><span>Gallery</span></a></li></ul>
		</div>
		<div id="contentarea">
			<!--<div id="left">
				
			</div>--><!-- left -->
			<!--<div id="wrapper">-->
				<div id="main">
										

<script type="text/javascript">
	<!--
	function showToc() {
		var toc = document.getElementById('documentationToc');
		var con = document.getElementById('documentationContent');
		var tab = document.getElementById('documentationTable');
		var lnk = document.getElementById('documentationTocLink');
		if(toc) {
			if(toc.style.visibility != 'collapse') {
				toc.style.visibility     = 'collapse';
				toc.style.display        = 'none';
				con.style.width          = '100%';
				tab.style.marginLeft     = '0';
				tab.style.width          = '805px';
				lnk.firstChild.nodeValue = 'show';
			} else {
				toc.style.visibility     = 'visible';
				toc.style.display        = '';
				con.style.width          = '642px';
				tab.style.marginLeft     = '0';
				tab.style.width          = '865px';
				lnk.firstChild.nodeValue = 'hide';
			}
		}
	}
-->
</script>

<!--<a href="javascript:showToc()" id="documentationTocLink">hide</a>-->
<table style="width: 100%; margin-left:0;" id="documentationTable">
	<tr>
		<td style="vertical-align: top; width: 153px; padding-right: 10px;" id="documentationToc">
			<div style="margin-bottom: 35px;">

<h1>
	<img class="headlinePrefix" src="/templates/diskohq/images/arrow_bg.png" alt=""/>
	Contents
</h1>
<ul class="table-of-contents-bullets">
	<li>Getting started
		<ul>
			<li><a href="/developers/documentation/installation/ubuntu.html">Ubuntu packages</a></li>
			<li><a href="/developers/documentation/installation/sources.html">Build from sources</a></li>
			<li><a href="/developers/documentation/tutorials/helloworld.html">Hello World</a></li>
			<!--<li><a  href="/developers/documentation/first-steps.html">Using Eclipse</a></li>-->
			<li><a  href="/developers/documentation/reference-platforms.html">Platforms</a></li>
			<li><a  href="/developers/documentation/roadmap.html">Roadmap</a></li>
			<li><a  href="/developers/documentation/api-reference/index.html" target="disko-api">API</a></li>
			<li><a  href="/developers/documentation/further-reading.html">Further reading</a></li>
		</ul>
	</li>
	<li style="margin-top:8px;">GUI programming
		<ul>

			<!--<li><a href="/developers/documentation/gui-reference/index.html">Introduction</a></li>
			<li><a href="/developers/documentation/gui-reference/description.html">Description</a></li>
			<li><a href="/developers/documentation/gui-reference/elements.html">Elements</a></li>
			<li><a href="/developers/documentation/gui-reference/gui-examples.html">XML Examples</a></li>
			<li><a href="/developers/documentation/gui-reference/mmsdialog.html">Dialogs</a></li>
			<li><a href="/developers/documentation/gui-reference/mmstheme.html">Themes</a></li>
			<li><a href="/developers/documentation/gui-reference/template.html">Templates</a></li>
			<li><a href="/developers/documentation/gui-reference/theme-processing.html">Theme processing</a></li>
			<li><a href="/developers/documentation/gui-reference/windows/general.html">Windows</a></li>
			<li><a href="/developers/documentation/gui-reference/widgets/general.html">Widgets</a></li>
			<li> </li>-->
			<li><a href="/developers/documentation/gui-reference/index.html">Introduction</a></li>
			<li><a href="/developers/documentation/gui-reference/windows/general.html">Windows</a></li>
			<li><a href="/developers/documentation/gui-reference/widgets/general.html">Widgets</a></li>
			<li><a href="/developers/documentation/gui-reference/mmstheme.html">Themes</a></li>
			<li><a href="/developers/documentation/gui-reference/template.html">Templates</a></li>
			<li><a href="/developers/documentation/gui-reference/gui-examples.html">XML Examples</a></li>
		</ul>
	</li>
	<li style="margin-top:8px;">Receipts &amp; Articles
		<ul>
			<li><a href="/developers/documentation/tutorials/helloworld.html">Hello World</a></li>
			<li><a href="/developers/documentation/tutorials/dialogs.html">Using dialog files</a></li>
			<li><a href="/developers/documentation/tutorials/themes.html">Using themes</a></li>
			<li><a href="/developers/documentation/tutorials/windows.html">Using windows</a></li>
			<li><a href="/developers/documentation/tutorials/inputs.html">Using inputs</a></li>
			<li><a href="/developers/documentation/tutorials/plugins.html">Using plugins</a></li>
			<li><a href="/developers/documentation/howtos/tcpservice.html">Disko IPC</a></li>
			<li><a href="/developers/documentation/howtos/translations.html">Multilanguage</a></li>
			<li><a href="/developers/documentation/howtos/usingframebuffer.html">Framebuffer setup</a></li>
			<li><a href="/developers/documentation/howtos/layersandwindows.html" class="active">Layers &amp; Windows</a></li>
			<li><a href="/developers/documentation/benchmarks/index.html">Benchmarks</a></li>
			<li><a href="/developers/documentation/omap/beagleboard.html">Beagleboard</a></li>
			<li><a href="/developers/documentation/howtos/utilizing_dragging_and_gestures.html">Drag &amp; gestures</a></li>
			<li><a href="/developers/documentation/omap/archos5.html">Archos 5 IT</a></li>
		</ul>
	</li>
</ul>
			</div>
						<script type="text/javascript">
						<!--
						
							jQuery(function() {
								jQuery('form.blGoogleSearch').find('input[type=text]').css('width', '135px');
								jQuery('form.blGoogleSearch').find('input[type=submit]').css({
									"background" : "url(/templates/diskohq/images/search.png) no-repeat",
									"border" : "0",
									"width" : "49px"
								});
								jQuery('form.blGoogleSearch').find('input[type=submit]').val("");
								
								jQuery('form.blGoogleSearch').parent().show();
							});							
							
							function blPostGSearch(i) {
								if (!i) {
									i = 0;
								}
								
								var el = jQuery('div.cse-overlay');
								el.css({'left' : '150px', 'top' : '50px'});
								
								if (jQuery('.cse-resultsContainer').length == 0 || i < 5) {
									window.setTimeout("blPostGSearch("+(i+1)+")", 0);
								}
								else {
									jQuery('body').prepend(jQuery('.cse-overlay'));
									jQuery('div.cse-overlay-bg').css('height', screen.height);
									jQuery('div.cse-overlay .cse-closeResults').unbind('click');
									jQuery('div.cse-overlay .cse-closeResults').click(function() {
										jQuery('body').append(jQuery('.cse-overlay'));
									});
								}
							}
						-->
						</script>

<!-- Google CSE code begins -->

<div style="display: none;">
	<form id="searchbox_011888066618628073463:roszvssi9we" class="blGoogleSearch" onsubmit="return false;" action="">
		<input type="text" class="g-q" name="q" size="20" style="color:black; width:135px;"/>
		<input type="submit" value="Search" onclick="blPostGSearch()"/>
		<input type="hidden" name="newwindow" value="0" /> 
	</form>
</div>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=searchbox_011888066618628073463:roszvssi9we"></script>
<script type="text/javascript" src="http://www.google.com/uds/api?file=uds.js&amp;v=1.0&amp;key=ABQIAAAAXhSh6dmfUTHjt7qAeufe2xQp2L91IAR1FgV0nETxn0m0APFJwBTgXMmeVmxm7Dc-oCcaqo8U_yPhsg"></script>
<script type="text/javascript" src="http://www.google.com/cse/api/overlay.js"></script>
<div id="results_011888066618628073463:roszvssi9we">
	<div class="cse-closeResults">
		<a>&times; close</a>
	</div>
	<div class="cse-resultsContainer" style="z-index:99;"></div>
</div>
<script type="text/javascript">
	function OnLoad() {
		cseo = new CSEOverlay("011888066618628073463:roszvssi9we",
							document.getElementById("searchbox_011888066618628073463:roszvssi9we"),
							document.getElementById("results_011888066618628073463:roszvssi9we"));
		cseo.searchControl.setSearchStartingCallback(null, blPostGSearch, null); 
	}
	GSearch.setOnLoadCallback(OnLoad);
</script>
<!-- Google CSE Code ends -->
		</td>
		<td style="vertical-align: top;" id="documentationContent">
			
<h1>Working with layers and windows</h1>

<h2>What is a layer?</h2>
<p>
	A layer represents a framebuffer (fbdev) or under X11 a image which will be
	put to the XServer via XSHM or XVSHM.
	The resolution of a layer can be set in the diskorc file.
</p>
<h3>Graphics section from diskorc to setup the X11 single-layer mode</h3>
<pre class="codelisting">
&lt;graphics&gt;
	&lt;parameter name="backend"                    value="X11"         /&gt;
	&lt;parameter name="outputtype"                 value="XSHM"        /&gt;
	&lt;parameter name="xres"                       value="1024"        /&gt;
	&lt;parameter name="yres"                       value="768"         /&gt;
	&lt;parameter name="xpos"                       value="0"           /&gt;
	&lt;parameter name="ypos"                       value="0"           /&gt;
	&lt;parameter name="videolayerid"               value="0"           /&gt;
	&lt;parameter name="videolayerpixelformat"      value="RGB32"       /&gt;
	&lt;parameter name="videolayerbuffermode"       value="BACKSYSTEM"  /&gt;
	&lt;parameter name="graphicslayerid"            value="0"           /&gt;
	&lt;parameter name="graphicslayerpixelformat"   value="RGB32"       /&gt;
	&lt;parameter name="graphicslayerbuffermode"    value="BACKSYSTEM"  /&gt;
&lt;/graphics&gt;</pre>

<h2>What are windows?</h2>
<p>
	In Disko we have four window types - Root, Main, Popup and Child windows.
	Windows are containers for widgets or Child windows.
	<img src="/documentation/howtos/../pics/layersandwindows.png" class="block" alt="Layers and windows"/>
</p>
<p>
	Root, Main and Popup windows will be displayed on a layer. Child windows can
	be used within these three windows. Only one Root and Main window can be
	displayed at the same time. Root windows will normally be used to display
	media streams such as TV, DVD, Video. Main windows normally shows the
	switcher and the context menu.
</p>
<div class="group">
	<p>
		The size of windows can be set in pixels or in percent. The percent value
		is related to the layer size for Root, Main and Popup windows. The size of a
		Child window is related to the size of the parent window. You should use
		percent values in your application wherever possible. So the port to
		different layer resolutions will be alleviated. For example to get a full
		screen window you should use 100% for it's width and height. So it will be
		dynamically fit to the layer size.
	</p>
	<pre class="codelisting" >
&lt;mainwindow name="mywindow" w="100%" h="100%"&gt;
	&lt;button name="button1" bgcolor="#800000ff" selbgcolor="#ff0000ff"/&gt;
	&lt;button name="button2" bgcolor="#008000ff" selbgcolor="#00ff00ff"/&gt;
	&lt;button name="button3" bgcolor="#000080ff" selbgcolor="#0000ffff"/&gt;
&lt;/mainwindow&gt;</pre>
</div>


<h2>Video and Graphics layer</h2>
<p>
	Any application based on the Disko framework is a two layer application.
	This is independent from the underlaying hardware, framebuffer, etc. We use
	the video layer to display different kind of media streams and the graphics
	layer for the On-Screen-Display. In the diskorc file you specify, if your
	system supports (and if you want to use) two layers. In single-layer mode,
	the video and graphics layer will be automatically merged without changing
	your application.
</p>
<div class="group">
	<p>
		Main and Popup windows will always be displayed on the graphics layer.
		Root windows can also be displayed on the graphics layer, but can be
		displayed on the video layer too (if two-layer mode is enabled in diskorc).
		You have to specify the MMSW_VIDEO flag if you want to play media streams
		on a MMSRootWindow which should be reside on the video layer (if two-layer
		mode is enabled in diskorc).
	</p>
	<pre class="codelisting">
// - construct the root window with MMSW_VIDEO flag
// - in two-layer-mode it will be displayed directly on the video layer
//   (layer surface will be used)
// - in single-layer-mode it will be displayed in the background
//   (lowest level in the window stack)
MMSRootWindow *window = new MMSRootWindow("", "100%", "100%",
                                          MMSALIGNMENT_CENTER, MMSW_VIDEO);
if (window) {
	// fill it white
	window->setBgColor(MMSFBColor(0xff,0xff,0xff,0xff));
	// show it
	window->show();
}</pre>
</div>


<h2>Single-layer mode</h2>
<p>
	If you use the X11 backend or a framebuffer which supports only one layer,
	you configure the videolayer and the graphicslayer to the same
	id - normally set it to zero. It is also possible to setup the
	graphicslayer only. Then Disko assumes, that the video layer is the same.
	The above-named MMSW_VIDEO flag will be ignored.
</p>

<h3>Graphics section from diskorc to setup X11/XVSHM</h3>
<pre class="codelisting">
&lt;graphics&gt;
	&lt;parameter name="backend"         value="X11"            /&gt;
	&lt;parameter name="outputtype"      value="XVSHM"          /&gt;
	&lt;graphicslayer&gt;
		&lt;parameter name="id"          value="0"          /&gt;
		&lt;parameter name="xres"        value="800"        /&gt;
		&lt;parameter name="yres"        value="600"        /&gt;
		&lt;parameter name="xpos"        value="0"          /&gt;
		&lt;parameter name="ypos"        value="0"          /&gt;
		&lt;parameter name="pixelformat" value="YV12"       /&gt;
		&lt;parameter name="options"     value=""           /&gt;
		&lt;parameter name="buffermode"  value="BACKSYSTEM" /&gt;
	&lt;/graphicslayer&gt;
&lt;/graphics&gt;
</pre>

<h2>Two-layer mode</h2>
<p>
	In this mode, the media streams can be put directly to the separate
	video layer. The blending of video and OSD will be done by the
	hardware. The layer settings are dependent on the backend
	(FBDEV, X11, DFB) and the particular outputtype
	(STDFB, OMAPFB, XVSHM, XSHM, DAVINCIFB, MATROXFB, ...).
	It is possible to use different resolutions for both layers.
</p>
<h3>
	Graphics section from diskorc to setup the davinci framebuffer with
	video and transparent OSD layer
</h3>

<pre class="codelisting" >
    &lt;graphics&gt;
        &lt;parameter name="backend"         value="FBDEV"      /&gt;
        &lt;parameter name="outputtype"      value="DAVINCIFB"  /&gt;
        &lt;graphicslayer&gt;
            &lt;parameter name="id"          value="0"          /&gt;
            &lt;parameter name="xres"        value="720"        /&gt;
            &lt;parameter name="yres"        value="480"        /&gt;
            &lt;parameter name="xpos"        value="0"          /&gt;
            &lt;parameter name="ypos"        value="0"          /&gt;
            &lt;parameter name="pixelformat" value="ARGB3565"   /&gt;
            &lt;parameter name="options"     value=""           /&gt;
            &lt;parameter name="buffermode"  value="BACKSYSTEM" /&gt;
        &lt;/graphicslayer&gt;
        &lt;videolayer&gt;
            &lt;parameter name="id"          value="1"          /&gt;
            &lt;parameter name="xres"        value="640"        /&gt;
            &lt;parameter name="yres"        value="480"        /&gt;
            &lt;parameter name="xpos"        value="0"          /&gt;
            &lt;parameter name="ypos"        value="0"          /&gt;
            &lt;parameter name="pixelformat" value="YUY2"       /&gt;
            &lt;parameter name="options"     value=""           /&gt;
            &lt;parameter name="buffermode"  value="BACKSYSTEM" /&gt;
        &lt;/videolayer&gt;
    &lt;/graphics&gt;
</pre>
<h3>Note</h3>
<p>
	For applications it is not recommended to put decoded stream data
	directly to the surface of the video layer. Applications should
	always use Root windows with the MMSW_VIDEO flag for that. You can
	get access to the surface of the window and play streams on it or
	use the Disko media classes MMSAV, MMSTV, MMSDVD and MMSVideo to
	play your media sources to your Root window.
</p>

<h2>Example: playing a video</h2>
<div class="group">
	<p>
		Using the Disko framework it is very simple to play any media
		sources. Here we show the usage of the MMSVideo class which is
		derived from MMSAV class. At first we create a new Root window,
		make it visible and construct a new MMSVideo class with it.
		MMSVideo will use the surface of the window to display the
		stream. This code works with any layer settings from diskorc
		(especially single- or two-layer mode). In two-layer mode the
		decoded stream will be directly put to the video layer.
	</p>
	<pre class="codelisting" >
// - construct the root window with MMSW_VIDEO flag
// - in two-layer-mode it will be displayed directly on the video layer
//   (layer surface will be used)
// - in single-layer-mode it will be displayed in the background
//   (lowest level in the window stack)
MMSRootWindow *window = new MMSRootWindow("", "100%", "100%",
                                          MMSALIGNMENT_CENTER, MMSW_VIDEO);
MMSVideo *video = NULL;
if (window) {
    // show it
    window->show();
    // construct video class
    video = new MMSVideo(window);
}
if (video) {
    // play a video
    video->startPlaying("videofile_or_uri");
}</pre>
</div>


		</td>
	</tr>
</table>
<div style="clear:both;">&nbsp;</div>

				</div>


				<!-- <div id="right">
					
				</div>--><!-- right -->
				<!--<div class="wrap"></div>
			</div>--><!-- wrapper -->
			<div class="wrap">&nbsp;</div>
		</div><!-- contentarea -->

		<!--<div id="footer">
			<p class="syndicate">
				
			</p>
			<div class="wrap"></div>
		</div>--><!-- footer -->

	</div><!-- all -->
	
	<script type="text/javascript">
		<!--
		redrawHeadline();
		repositionMenu();
		//fixPre();

		function msgHiding() {
			var msgs = document.getElementById('messages');
		
			if(msgs) {
				msgs.style.visibility = 'hidden';
				msgs.style.display    = 'none';
			}
		}
		window.setTimeout("msgHiding()", 5000);
 		
//	slideToggle('slow', function () {
// 				jQuery('#messages:visible');
// 		});
		

		-->
	</script>

	<!-- Google Analytics -->
	<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
	var pageTracker = _gat._getTracker("UA-1675780-3");
	pageTracker._trackPageview();
</script>
</body>
</html>
 
