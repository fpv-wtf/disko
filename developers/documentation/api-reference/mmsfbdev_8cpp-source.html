<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Disko API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);' >
<div id="top">
<div id="titlearea" style="background:#262929;">
  <div id="projectlogo">
    <img alt="Logo" src="./disko-logo.png" style="float:left;"/>
    <br clear="all"/>
  </div>
</div>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
<h1>mmsfbdev.cpp</h1><a href="mmsfbdev_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *   Copyright (C) 2005-2007 Stefan Schwarzer, Jens Schneider,             *</span>
<a name="l00003"></a>00003 <span class="comment"> *                           Matthias Hardt, Guido Madaus                  *</span>
<a name="l00004"></a>00004 <span class="comment"> *                                                                         *</span>
<a name="l00005"></a>00005 <span class="comment"> *   Copyright (C) 2007-2008 BerLinux Solutions GbR                        *</span>
<a name="l00006"></a>00006 <span class="comment"> *                           Stefan Schwarzer &amp; Guido Madaus               *</span>
<a name="l00007"></a>00007 <span class="comment"> *                                                                         *</span>
<a name="l00008"></a>00008 <span class="comment"> *   Copyright (C) 2009-2013 BerLinux Solutions GmbH                       *</span>
<a name="l00009"></a>00009 <span class="comment"> *                                                                         *</span>
<a name="l00010"></a>00010 <span class="comment"> *   Authors:                                                              *</span>
<a name="l00011"></a>00011 <span class="comment"> *      Stefan Schwarzer   &lt;stefan.schwarzer@diskohq.org&gt;,                 *</span>
<a name="l00012"></a>00012 <span class="comment"> *      Matthias Hardt     &lt;matthias.hardt@diskohq.org&gt;,                   *</span>
<a name="l00013"></a>00013 <span class="comment"> *      Jens Schneider     &lt;jens.schneider@diskohq.org&gt;,                   *</span>
<a name="l00014"></a>00014 <span class="comment"> *      Guido Madaus       &lt;guido.madaus@diskohq.org&gt;,                     *</span>
<a name="l00015"></a>00015 <span class="comment"> *      Patrick Helterhoff &lt;patrick.helterhoff@diskohq.org&gt;,               *</span>
<a name="l00016"></a>00016 <span class="comment"> *      René Bählkow       &lt;rene.baehlkow@diskohq.org&gt;                     *</span>
<a name="l00017"></a>00017 <span class="comment"> *                                                                         *</span>
<a name="l00018"></a>00018 <span class="comment"> *   This library is free software; you can redistribute it and/or         *</span>
<a name="l00019"></a>00019 <span class="comment"> *   modify it under the terms of the GNU Lesser General Public            *</span>
<a name="l00020"></a>00020 <span class="comment"> *   License version 2.1 as published by the Free Software Foundation.     *</span>
<a name="l00021"></a>00021 <span class="comment"> *                                                                         *</span>
<a name="l00022"></a>00022 <span class="comment"> *   This library is distributed in the hope that it will be useful,       *</span>
<a name="l00023"></a>00023 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *</span>
<a name="l00024"></a>00024 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU     *</span>
<a name="l00025"></a>00025 <span class="comment"> *   Lesser General Public License for more details.                       *</span>
<a name="l00026"></a>00026 <span class="comment"> *                                                                         *</span>
<a name="l00027"></a>00027 <span class="comment"> *   You should have received a copy of the GNU Lesser General Public      *</span>
<a name="l00028"></a>00028 <span class="comment"> *   License along with this library; if not, write to the                 *</span>
<a name="l00029"></a>00029 <span class="comment"> *   Free Software Foundation, Inc.,                                       *</span>
<a name="l00030"></a>00030 <span class="comment"> *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA            *</span>
<a name="l00031"></a>00031 <span class="comment"> **************************************************************************/</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#ifdef __HAVE_FBDEV__</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;strings.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;sys/mman.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;sys/kd.h&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;linux/vt.h&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include "<a class="code" href="mmsfbdev_8h.html">mmsgui/fb/mmsfbdev.h</a>"</span>
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="mmsfbdev_8cpp.html#2475d8f125dae96d07c18629c5f4120d">00048</a> <span class="preprocessor">#define INITCHECK  if(!this-&gt;isinitialized){MMSFB_SetError(0,"MMSFBDev is not initialized");return false;}</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>
<a name="l00050"></a><a class="code" href="classMMSFBDev.html#216ccc4e833160331259093868edc883">00050</a> <a class="code" href="classMMSFBDev.html#216ccc4e833160331259093868edc883">MMSFBDev::MMSFBDev</a>() {
<a name="l00051"></a>00051     <span class="comment">// init fb vals</span>
<a name="l00052"></a>00052     this-&gt;<a class="code" href="classMMSFBDev.html#3b42ac577cc48a05b3546df72d12b279" title="is initialized?">isinitialized</a> = <span class="keyword">false</span>;
<a name="l00053"></a>00053     this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a> = -1;
<a name="l00054"></a>00054     this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a> = NULL;
<a name="l00055"></a>00055     this-&gt;<a class="code" href="classMMSFBDev.html#005c5f72dedd7fa92e37356620d8b566" title="have to reset the console acceleration">reset_console_accel</a> = <span class="keyword">false</span>;
<a name="l00056"></a>00056     memset(this-&gt;<a class="code" href="classMMSFBDev.html#35d279c05e38dea2c6f6932af9306adb" title="available modes read from /etc/fb.modes">modes</a>, 0, <span class="keyword">sizeof</span>(this-&gt;<a class="code" href="classMMSFBDev.html#35d279c05e38dea2c6f6932af9306adb" title="available modes read from /etc/fb.modes">modes</a>));
<a name="l00057"></a>00057     this-&gt;<a class="code" href="classMMSFBDev.html#f4fa59e1da4a6db81ef67f569b2cbecd" title="number of loaded modes">modes_cnt</a> = 0;
<a name="l00058"></a>00058     memset(this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>, 0, <span class="keyword">sizeof</span>(this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>));
<a name="l00059"></a>00059     this-&gt;<a class="code" href="classMMSFBDev.html#38e7c26220d4e667e01561d2aef2b9ff" title="number of layers">layers_cnt</a> = 0;
<a name="l00060"></a>00060     this-&gt;<a class="code" href="classMMSFBDev.html#ac7d9655a7c8d5684168da2aea290847" title="id of the active screen (this is for fbs != vesa)">active_screen</a> = 0;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062     <span class="comment">// init terminal vals</span>
<a name="l00063"></a>00063     this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a> = -1;
<a name="l00064"></a>00064     this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a> = -1;
<a name="l00065"></a>00065     this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a> = -1;
<a name="l00066"></a>00066     this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#67b552a6eef50151249400b6ddfcf480" title="number of vt from which disko was started">previous</a> = -1;
<a name="l00067"></a>00067     this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#6724489d2e79fa5f315f5bedcd5eb3e1" title="save original fb">org_fb</a> = -1;
<a name="l00068"></a>00068 }
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="classMMSFBDev.html#e1ed2757e298c7c651bd8ca857867261">00070</a> <a class="code" href="classMMSFBDev.html#e1ed2757e298c7c651bd8ca857867261">MMSFBDev::~MMSFBDev</a>() {
<a name="l00071"></a>00071     <a class="code" href="classMMSFBDev.html#1512ce90aefefe883d165ffa1c5b304f">closeDevice</a>();
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="classMMSFBDev.html#ce4dfa1ff8f302e56e50f3b0bc228f2c">00074</a> <span class="keywordtype">void</span> <a class="code" href="classMMSFBDev.html#ce4dfa1ff8f302e56e50f3b0bc228f2c">MMSFBDev::printFixScreenInfo</a>() {
<a name="l00075"></a>00075     <span class="keywordtype">char</span> <span class="keywordtype">id</span>[17];
<a name="l00076"></a>00076     <span class="keywordtype">id</span>[16]=0;
<a name="l00077"></a>00077     printf(<span class="stringliteral">"MMSFBDev: fix screen info ------------\n"</span>);
<a name="l00078"></a>00078     printf(<span class="stringliteral">"    device         = %s\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>.c_str());
<a name="l00079"></a>00079     memcpy(<span class="keywordtype">id</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#8e40083abdd2a2e560ebad25a75626d4">id</a>, 16);
<a name="l00080"></a>00080     printf(<span class="stringliteral">"    id             = %s\n"</span>, <span class="keywordtype">id</span>);
<a name="l00081"></a>00081     printf(<span class="stringliteral">"    smem_start     = 0x%x\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#2d6b15a9cc46b488b05eb30003c76b4a">smem_start</a>);
<a name="l00082"></a>00082     printf(<span class="stringliteral">"    smem_len       = %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#f6272eb9ab0711edaa2532758fafef65">smem_len</a>);
<a name="l00083"></a>00083     printf(<span class="stringliteral">"    type           = %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#9992dc9d1719386363c71d49f4a005cd">type</a>);
<a name="l00084"></a>00084     printf(<span class="stringliteral">"    type_aux       = %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#69a68d4bb17bd01155dfc0ccd175fe96">type_aux</a>);
<a name="l00085"></a>00085     printf(<span class="stringliteral">"    visual         = %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#8c20641c7b21eab1ac05a25b1c12600f">visual</a>);
<a name="l00086"></a>00086     printf(<span class="stringliteral">"    xpanstep       = %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#2136082f96f6c3ba74ff38c16f9660ec">xpanstep</a>);
<a name="l00087"></a>00087     printf(<span class="stringliteral">"    ypanstep       = %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#10941d6d21cd86a2517dddeff8cd5355">ypanstep</a>);
<a name="l00088"></a>00088     printf(<span class="stringliteral">"    ywrapstep      = %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#53628e0b383a588a5f7caf35d1820c7d">ywrapstep</a>);
<a name="l00089"></a>00089     printf(<span class="stringliteral">"    line_length    = %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#7131a5355e595cd09772d29663afdd00">line_length</a>);
<a name="l00090"></a>00090     printf(<span class="stringliteral">"    mmio_start     = 0x%x\n"</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#401d77fa4f32c1f8572d31a22e21f04c">mmio_start</a>);
<a name="l00091"></a>00091     printf(<span class="stringliteral">"    mmio_len       = %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#5fb1aa292e1ed70f714179a2d71ba207">mmio_len</a>);
<a name="l00092"></a>00092     printf(<span class="stringliteral">"    accel          = %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#73b0e7b58b980ad86349a0e1618b2ecf">accel</a>);
<a name="l00093"></a>00093     printf(<span class="stringliteral">"    reserved[3]    = %d, %d, %d\n"</span>, <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#442fd02bd46ce28b2a8c90a4a8dc45ad">reserved</a>[0], <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#442fd02bd46ce28b2a8c90a4a8dc45ad">reserved</a>[1], <a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#442fd02bd46ce28b2a8c90a4a8dc45ad">reserved</a>[2]);
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="classMMSFBDev.html#a56d804fbfbd26ff16978a272283a8ab">00096</a> <span class="keywordtype">void</span> <a class="code" href="classMMSFBDev.html#a56d804fbfbd26ff16978a272283a8ab">MMSFBDev::printVarScreenInfo</a>() {
<a name="l00097"></a>00097     printf(<span class="stringliteral">"MMSFBDev: var screen info ------------\n"</span>);
<a name="l00098"></a>00098     printf(<span class="stringliteral">"    xres           = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>);
<a name="l00099"></a>00099     printf(<span class="stringliteral">"    yres           = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>);
<a name="l00100"></a>00100     printf(<span class="stringliteral">"    xres_virtual   = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#51132691fa95f57c448db6af35f0b884">xres_virtual</a>);
<a name="l00101"></a>00101     printf(<span class="stringliteral">"    yres_virtual   = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5eba4164bc628e5dc7b1c2591e0101c4">yres_virtual</a>);
<a name="l00102"></a>00102     printf(<span class="stringliteral">"    xoffset        = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#137e1c4baafbdaeb3148943e8b2cddc6">xoffset</a>);
<a name="l00103"></a>00103     printf(<span class="stringliteral">"    yoffset        = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#7cde086a03e8f02a172096c772841b9d">yoffset</a>);
<a name="l00104"></a>00104     printf(<span class="stringliteral">"    bits_per_pixel = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a>);
<a name="l00105"></a>00105     printf(<span class="stringliteral">"    grayscale      = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#edb2c5242b9bb987df7ab05dd982424c">grayscale</a>);
<a name="l00106"></a>00106     printf(<span class="stringliteral">"    red            = %d(offs=%d)\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a>);
<a name="l00107"></a>00107     printf(<span class="stringliteral">"    green          = %d(offs=%d)\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a>);
<a name="l00108"></a>00108     printf(<span class="stringliteral">"    blue           = %d(offs=%d)\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a>);
<a name="l00109"></a>00109     printf(<span class="stringliteral">"    transp         = %d(offs=%d)\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#61d4784b3011538ed42dd54e0673b9a2">transp</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#61d4784b3011538ed42dd54e0673b9a2">transp</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a>);
<a name="l00110"></a>00110     printf(<span class="stringliteral">"    nonstd         = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f52fb6a7f76db38e1815d854fc16b018">nonstd</a>);
<a name="l00111"></a>00111     printf(<span class="stringliteral">"    activate       = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#79a05843d2117209fdc5953e5b93776b">activate</a>);
<a name="l00112"></a>00112     printf(<span class="stringliteral">"    height         = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f70eb3a1a12cb198ee00fb0ac07d783d">height</a>);
<a name="l00113"></a>00113     printf(<span class="stringliteral">"    width          = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#47007ea3bae58683c62588cfe49dc323">width</a>);
<a name="l00114"></a>00114     printf(<span class="stringliteral">"    accel_flags    = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#262518fdf525633779513d3a5c772b49">accel_flags</a>);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     printf(<span class="stringliteral">"    pixclock       = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#8cee8e95f395a7f32b82187fce857afc">pixclock</a>);
<a name="l00117"></a>00117     printf(<span class="stringliteral">"    left_margin    = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#858a7c2a41cc706776661bb42d01c114">left_margin</a>);
<a name="l00118"></a>00118     printf(<span class="stringliteral">"    right_margin   = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#717ec20616aa67b046dcda6e2c8777c7">right_margin</a>);
<a name="l00119"></a>00119     printf(<span class="stringliteral">"    upper_margin   = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#8768ce4041d58b0d77b237fa66730065">upper_margin</a>);
<a name="l00120"></a>00120     printf(<span class="stringliteral">"    lower_margin   = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c0b4394896b9f2b0ee0f489a8ce16293">lower_margin</a>);
<a name="l00121"></a>00121     printf(<span class="stringliteral">"    hsync_len      = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#6adbe7664ad821c5d3188177d60a91dc">hsync_len</a>);
<a name="l00122"></a>00122     printf(<span class="stringliteral">"    vsync_len      = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#20d9053cf404b27eedb25f8c6eb6b338">vsync_len</a>);
<a name="l00123"></a>00123     printf(<span class="stringliteral">"    sync           = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f00abfb9ee2072fc34336893c2ee71fd">sync</a>);
<a name="l00124"></a>00124     printf(<span class="stringliteral">"    vmode          = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#2634d06c75d3919e39aff615cc428427">vmode</a>);
<a name="l00125"></a>00125     printf(<span class="stringliteral">"    rotate         = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#3e2d62ca011a1a0b69d80c508dea4b1d">rotate</a>);
<a name="l00126"></a>00126     printf(<span class="stringliteral">"    accel_flags    = %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#262518fdf525633779513d3a5c772b49">accel_flags</a>);
<a name="l00127"></a>00127     printf(<span class="stringliteral">"    reserved[5]    = %d, %d, %d, %d, %d\n"</span>, <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#688af9c78092d3fa641649c8e8c413c7">reserved</a>[0], <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#688af9c78092d3fa641649c8e8c413c7">reserved</a>[1], <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#688af9c78092d3fa641649c8e8c413c7">reserved</a>[2], <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#688af9c78092d3fa641649c8e8c413c7">reserved</a>[3], <a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#688af9c78092d3fa641649c8e8c413c7">reserved</a>[4]);
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="classMMSFBDev.html#e4e339e84b5d70da214e6ece641f63d0">00130</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#e4e339e84b5d70da214e6ece641f63d0">MMSFBDev::buildPixelFormat</a>() {
<a name="l00131"></a>00131     this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb74b6cc9edc897476f6dd3326596be82e" title="none">MMSFB_PF_NONE</a>;
<a name="l00132"></a>00132     <span class="keywordflow">switch</span> (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#61d4784b3011538ed42dd54e0673b9a2">transp</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a>) {
<a name="l00133"></a>00133     <span class="keywordflow">case</span> 0:
<a name="l00134"></a>00134         <span class="comment">// pixelformat with no alphachannel</span>
<a name="l00135"></a>00135         <span class="keywordflow">if</span>    ((<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 5)  &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 6) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 5)
<a name="l00136"></a>00136             &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 11) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 5) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 0)) {
<a name="l00137"></a>00137             this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbf2dcc7252d01244bb0310acbeebac065" title="16 bit RGB (2 byte, red 5@11, green 6@5, blue 5@0)">MMSFB_PF_RGB16</a>;
<a name="l00138"></a>00138         }
<a name="l00139"></a>00139         <span class="keywordflow">else</span>
<a name="l00140"></a>00140         <span class="keywordflow">if</span>    ((<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8)  &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8)
<a name="l00141"></a>00141             &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 16) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 8) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 0)) {
<a name="l00142"></a>00142             <span class="keywordflow">if</span> (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a> == 24)
<a name="l00143"></a>00143                 this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbef503211e6a53fa32acc7cb3510725ff" title="24 bit RGB (3 byte, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_RGB24</a>;
<a name="l00144"></a>00144             <span class="keywordflow">else</span>
<a name="l00145"></a>00145                 this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb3fa49fd5fdfda2769f69d8ace11a9df4" title="24 bit RGB (4 byte, nothing 8@24, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_RGB32</a>;
<a name="l00146"></a>00146         }
<a name="l00147"></a>00147         <span class="keywordflow">else</span>
<a name="l00148"></a>00148         <span class="keywordflow">if</span>    ((<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8)
<a name="l00149"></a>00149             &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 0) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 8) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 16)) {
<a name="l00150"></a>00150             <span class="keywordflow">if</span> (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a> == 24)
<a name="l00151"></a>00151                 this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbaa98ceff879daa56e2c1c9b73fb16e61" title="24 bit BGR (3 byte, blue 8@16, green 8@8, red 8@0)">MMSFB_PF_BGR24</a>;
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153         <span class="keywordflow">else</span>
<a name="l00154"></a>00154         <span class="keywordflow">if</span>    ((<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 5) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 5) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 5)
<a name="l00155"></a>00155             &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 0) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 5) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 10)) {
<a name="l00156"></a>00156             <span class="keywordflow">if</span> (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a> == 16)
<a name="l00157"></a>00157                 this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbdd5e5748f418ad358736e98b450c1993" title="15 bit BGR (2 byte, nothing 1@15, blue 5@10, green 5@5, red 5@0)">MMSFB_PF_BGR555</a>;
<a name="l00158"></a>00158         }
<a name="l00159"></a>00159         <span class="keywordflow">else</span>
<a name="l00160"></a>00160         <span class="keywordflow">if</span>    ((<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 0) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 0) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 0)
<a name="l00161"></a>00161             &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 0) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 0) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 0)) {
<a name="l00162"></a>00162             <span class="keywordflow">if</span> (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a> == 4)
<a name="l00163"></a>00163                 this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb3d13c45a149f4c4d46d515acf3bb0823" title="4 bit alpha (1 byte/2 pixel, more significant nibble used first)">MMSFB_PF_A4</a>;
<a name="l00164"></a>00164             <span class="keywordflow">else</span>
<a name="l00165"></a>00165             <span class="keywordflow">if</span> (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a> == 16)
<a name="l00166"></a>00166                 this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbae1d0cbd4a145847d6541dd75cc47bdb" title="16 bit YUV (4 byte/2 pixel, macropixel contains CbYCrY [31:0])">MMSFB_PF_YUY2</a>;
<a name="l00167"></a>00167             <span class="keywordflow">else</span>
<a name="l00168"></a>00168                 this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb74b6cc9edc897476f6dd3326596be82e" title="none">MMSFB_PF_NONE</a>;
<a name="l00169"></a>00169         }
<a name="l00170"></a>00170         <span class="keywordflow">break</span>;
<a name="l00171"></a>00171     <span class="keywordflow">case</span> 8:
<a name="l00172"></a>00172         <span class="comment">// pixelformat with 8 bit alphachannel</span>
<a name="l00173"></a>00173         <span class="keywordflow">if</span>    ((<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8)  &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8)
<a name="l00174"></a>00174             &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 16) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 8) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 0)) {
<a name="l00175"></a>00175             this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bba716d7315027968d1f6f7db7e3ba9257" title="32 bit ARGB (4 byte, alpha 8@24, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_ARGB</a>;
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177         <span class="keywordflow">else</span>
<a name="l00178"></a>00178         <span class="keywordflow">if</span>    ((<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8)  &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> == 8)
<a name="l00179"></a>00179             &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 0) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 8) &amp;&amp; (<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> == 16)) {
<a name="l00180"></a>00180             this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a> = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbb2157a444d96c25b1b56cfe9b6f9ec85" title="32 bit ABGR (4 byte, alpha 8@24, blue 8@16, green 8@8, red 8@0)">MMSFB_PF_ABGR</a>;
<a name="l00181"></a>00181         }
<a name="l00182"></a>00182         <span class="keywordflow">break</span>;
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].pixelformat != <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb74b6cc9edc897476f6dd3326596be82e" title="none">MMSFB_PF_NONE</a>) {
<a name="l00186"></a>00186         printf(<span class="stringliteral">"MMSFBDev: current pixelformat is %s\n"</span>, <a class="code" href="mmstypes_8h.html#6727c4c364ac2d2ff384ac40cea47b17">getMMSFBPixelFormatString</a>(this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].pixelformat).c_str());
<a name="l00187"></a>00187         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00188"></a>00188     }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="classMMSFBDev.html#8f561615fe7dd64263a001a9ec4a7bba">00193</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#8f561615fe7dd64263a001a9ec4a7bba">MMSFBDev::readModes</a>() {
<a name="l00194"></a>00194     <span class="comment">// reset mode list</span>
<a name="l00195"></a>00195     this-&gt;<a class="code" href="classMMSFBDev.html#f4fa59e1da4a6db81ef67f569b2cbecd" title="number of loaded modes">modes_cnt</a> = 0;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="comment">// open fb.modes</span>
<a name="l00198"></a>00198     FILE *<a class="code" href="tools_8cpp.html#a065f30aa9f5f9a42132c82c787ee70b">fp</a>;
<a name="l00199"></a>00199     <span class="keywordflow">if</span> (!(fp = fopen(<span class="stringliteral">"/etc/fb.modes"</span>,<span class="stringliteral">"r"</span>)))
<a name="l00200"></a>00200         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202     <span class="comment">// through all lines</span>
<a name="l00203"></a>00203     <span class="keywordtype">char</span> line[128];
<a name="l00204"></a>00204     <span class="keywordflow">while</span> (fgets(line, <span class="keyword">sizeof</span>(line)-1, fp)) {
<a name="l00205"></a>00205         <span class="keywordtype">char</span> label[32];
<a name="l00206"></a>00206         <span class="keywordflow">if</span> (sscanf(line, <span class="stringliteral">"mode \"%31[^\"]\""</span>, label) == 1) {
<a name="l00207"></a>00207             <span class="comment">// mode found</span>
<a name="l00208"></a>00208             <span class="keywordtype">bool</span> geom_set = <span class="keyword">false</span>;
<a name="l00209"></a>00209             <span class="keywordtype">bool</span> timings_set = <span class="keyword">false</span>;
<a name="l00210"></a>00210             <span class="keyword">struct </span><a class="code" href="structfb__var__screeninfo.html">fb_var_screeninfo</a> *mode = &amp;this-&gt;<a class="code" href="classMMSFBDev.html#35d279c05e38dea2c6f6932af9306adb" title="available modes read from /etc/fb.modes">modes</a>[this-&gt;<a class="code" href="classMMSFBDev.html#f4fa59e1da4a6db81ef67f569b2cbecd" title="number of loaded modes">modes_cnt</a>];
<a name="l00211"></a>00211             memset(mode, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structfb__var__screeninfo.html">fb_var_screeninfo</a>));
<a name="l00212"></a>00212 
<a name="l00213"></a>00213             <span class="comment">// parse for settings</span>
<a name="l00214"></a>00214             <span class="keywordflow">while</span> (fgets(line, <span class="keyword">sizeof</span>(line)-1, fp) &amp;&amp; !(strstr(line, <span class="stringliteral">"endmode"</span>))) {
<a name="l00215"></a>00215                 <span class="keywordtype">char</span> value[16];
<a name="l00216"></a>00216                 <span class="keywordtype">int</span> dummy;
<a name="l00217"></a>00217                 <span class="keywordflow">if</span> (sscanf(line, <span class="stringliteral">" geometry %d %d %d %d %d"</span>,
<a name="l00218"></a>00218                                 &amp;mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>, &amp;mode-&gt;<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>, &amp;dummy, &amp;dummy, &amp;mode-&gt;<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a>) == 5)
<a name="l00219"></a>00219                     geom_set = <span class="keyword">true</span>;
<a name="l00220"></a>00220                 <span class="keywordflow">else</span>
<a name="l00221"></a>00221                 <span class="keywordflow">if</span> (sscanf(line, <span class="stringliteral">" timings %d %d %d %d %d %d %d"</span>,
<a name="l00222"></a>00222                                 &amp;mode-&gt;<a class="code" href="structfb__var__screeninfo.html#8cee8e95f395a7f32b82187fce857afc">pixclock</a>, &amp;mode-&gt;<a class="code" href="structfb__var__screeninfo.html#858a7c2a41cc706776661bb42d01c114">left_margin</a>,  &amp;mode-&gt;<a class="code" href="structfb__var__screeninfo.html#717ec20616aa67b046dcda6e2c8777c7">right_margin</a>,
<a name="l00223"></a>00223                                 &amp;mode-&gt;<a class="code" href="structfb__var__screeninfo.html#8768ce4041d58b0d77b237fa66730065">upper_margin</a>, &amp;mode-&gt;<a class="code" href="structfb__var__screeninfo.html#c0b4394896b9f2b0ee0f489a8ce16293">lower_margin</a>, &amp;mode-&gt;<a class="code" href="structfb__var__screeninfo.html#6adbe7664ad821c5d3188177d60a91dc">hsync_len</a>, &amp;mode-&gt;<a class="code" href="structfb__var__screeninfo.html#20d9053cf404b27eedb25f8c6eb6b338">vsync_len</a>) == 7)
<a name="l00224"></a>00224                     timings_set = <span class="keyword">true</span>;
<a name="l00225"></a>00225                 <span class="keywordflow">else</span>
<a name="l00226"></a>00226                 <span class="keywordflow">if</span> ((sscanf(line, <span class="stringliteral">" hsync %15s"</span>, value) == 1) &amp;&amp; !strcasecmp(value, <span class="stringliteral">"high"</span>))
<a name="l00227"></a>00227                     mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f00abfb9ee2072fc34336893c2ee71fd">sync</a> |= <a class="code" href="fb_8h.html#d817c7f54d904d08dbcd1e51a6a80194">FB_SYNC_HOR_HIGH_ACT</a>;
<a name="l00228"></a>00228                 <span class="keywordflow">else</span>
<a name="l00229"></a>00229                 <span class="keywordflow">if</span> ((sscanf(line, <span class="stringliteral">" vsync %15s"</span>, value) == 1) &amp;&amp; !strcasecmp(value, <span class="stringliteral">"high"</span>))
<a name="l00230"></a>00230                     mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f00abfb9ee2072fc34336893c2ee71fd">sync</a> |= <a class="code" href="fb_8h.html#b31737a39a298bb54df6dba73437941f">FB_SYNC_VERT_HIGH_ACT</a>;
<a name="l00231"></a>00231                 <span class="keywordflow">else</span>
<a name="l00232"></a>00232                 <span class="keywordflow">if</span> ((sscanf(line, <span class="stringliteral">" csync %15s"</span>, value) == 1) &amp;&amp; !strcasecmp(value, <span class="stringliteral">"high"</span>))
<a name="l00233"></a>00233                     mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f00abfb9ee2072fc34336893c2ee71fd">sync</a> |= <a class="code" href="fb_8h.html#d4e53a189b980adf845465d1409ee85d">FB_SYNC_COMP_HIGH_ACT</a>;
<a name="l00234"></a>00234                 <span class="keywordflow">else</span>
<a name="l00235"></a>00235                 <span class="keywordflow">if</span> ((sscanf(line, <span class="stringliteral">" gsync %15s"</span>, value) == 1) &amp;&amp; !strcasecmp(value, <span class="stringliteral">"true"</span>))
<a name="l00236"></a>00236                     mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f00abfb9ee2072fc34336893c2ee71fd">sync</a> |= <a class="code" href="fb_8h.html#9c1c690bf980bdb9f9e3a3c9afa6b1fb">FB_SYNC_ON_GREEN</a>;
<a name="l00237"></a>00237                 <span class="keywordflow">else</span>
<a name="l00238"></a>00238                 <span class="keywordflow">if</span> ((sscanf(line, <span class="stringliteral">" extsync %15s"</span>, value) == 1) &amp;&amp; !strcasecmp(value, <span class="stringliteral">"true"</span>))
<a name="l00239"></a>00239                     mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f00abfb9ee2072fc34336893c2ee71fd">sync</a> |= <a class="code" href="fb_8h.html#2f09632f22f66a23a245f1bc8bcfdcc5">FB_SYNC_EXT</a>;
<a name="l00240"></a>00240                 <span class="keywordflow">else</span>
<a name="l00241"></a>00241                 <span class="keywordflow">if</span> ((sscanf(line, <span class="stringliteral">" bcast %15s"</span>, value) == 1) &amp;&amp; !strcasecmp(value, <span class="stringliteral">"true"</span>))
<a name="l00242"></a>00242                     mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f00abfb9ee2072fc34336893c2ee71fd">sync</a> |= <a class="code" href="fb_8h.html#b5e3f57ea7d3f8464bd5add201a1f684">FB_SYNC_BROADCAST</a>;
<a name="l00243"></a>00243                 <span class="keywordflow">else</span>
<a name="l00244"></a>00244                 <span class="keywordflow">if</span> ((sscanf(line, <span class="stringliteral">" laced %15s"</span>, value) == 1) &amp;&amp; !strcasecmp(value, <span class="stringliteral">"true"</span>))
<a name="l00245"></a>00245                     mode-&gt;<a class="code" href="structfb__var__screeninfo.html#2634d06c75d3919e39aff615cc428427">vmode</a> |= <a class="code" href="fb_8h.html#51f973e2e1d6f4bffac817950fee115a">FB_VMODE_INTERLACED</a>;
<a name="l00246"></a>00246                 <span class="keywordflow">else</span>
<a name="l00247"></a>00247                 <span class="keywordflow">if</span> ((sscanf(line, <span class="stringliteral">" double %15s"</span>, value) == 1) &amp;&amp; !strcasecmp(value, <span class="stringliteral">"true"</span>))
<a name="l00248"></a>00248                     mode-&gt;<a class="code" href="structfb__var__screeninfo.html#2634d06c75d3919e39aff615cc428427">vmode</a> |= <a class="code" href="fb_8h.html#92febe7bffe1dc9459fb358bf8e40071">FB_VMODE_DOUBLE</a>;
<a name="l00249"></a>00249             }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251             <span class="keywordflow">if</span> (geom_set &amp;&amp; timings_set) {
<a name="l00252"></a>00252                 <span class="comment">// add mode to list</span>
<a name="l00253"></a>00253                 this-&gt;<a class="code" href="classMMSFBDev.html#f4fa59e1da4a6db81ef67f569b2cbecd" title="number of loaded modes">modes_cnt</a>++;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255                 printf(<span class="stringliteral">"MMSFBDev: mode %s (%dx%d, %d bits) loaded from /etc/fb.modes\n"</span>, label, mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>, mode-&gt;<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>, mode-&gt;<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a>);
<a name="l00256"></a>00256             }
<a name="l00257"></a>00257             <span class="keywordflow">else</span> {
<a name="l00258"></a>00258                 <span class="comment">// ignore mode</span>
<a name="l00259"></a>00259                 printf(<span class="stringliteral">"MMSFBDev: ignore mode %s (%dx%d, %d bits) from /etc/fb.modes\n"</span>, label, mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>, mode-&gt;<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>, mode-&gt;<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a>);
<a name="l00260"></a>00260             }
<a name="l00261"></a>00261         }
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     fclose (fp);
<a name="l00265"></a>00265     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="classMMSFBDev.html#3858d84372cf5002cce2af437431f186">00269</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#3858d84372cf5002cce2af437431f186">MMSFBDev::openDevice</a>(<span class="keywordtype">char</span> *<a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>, <span class="keywordtype">int</span> console) {
<a name="l00270"></a>00270     <span class="comment">// close the device if opened</span>
<a name="l00271"></a>00271     <a class="code" href="classMMSFBDev.html#1512ce90aefefe883d165ffa1c5b304f">closeDevice</a>();
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     <span class="keywordflow">if</span> (device_file) {
<a name="l00274"></a>00274         <span class="comment">// open given device</span>
<a name="l00275"></a>00275         this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a> = open(device_file, O_RDWR);
<a name="l00276"></a>00276         <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a> &lt; 0) {
<a name="l00277"></a>00277             printf(<span class="stringliteral">"MMSFBDev: opening device %s failed\n"</span>, device_file);
<a name="l00278"></a>00278             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280         this-&gt;device_file = device_file;
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282     <span class="keywordflow">else</span> {
<a name="l00283"></a>00283         <span class="comment">// open standard device</span>
<a name="l00284"></a>00284         this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a> = open(<span class="stringliteral">"/dev/fb0"</span>, O_RDWR);
<a name="l00285"></a>00285         <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a> &lt; 0) {
<a name="l00286"></a>00286             this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a> = open(<span class="stringliteral">"/dev/fb/0"</span>, O_RDWR);
<a name="l00287"></a>00287             <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a> &lt; 0) {
<a name="l00288"></a>00288                 printf(<span class="stringliteral">"MMSFBDev: opening device /dev/fb0 and /dev/fb/0 failed\n"</span>);
<a name="l00289"></a>00289                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00290"></a>00290             }
<a name="l00291"></a>00291             this-&gt;device_file = <span class="stringliteral">"/dev/fb/0"</span>;
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293         <span class="keywordflow">else</span>
<a name="l00294"></a>00294             this-&gt;device_file = <span class="stringliteral">"/dev/fb0"</span>;
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="comment">// file descriptor should be closed when an exec function is invoked</span>
<a name="l00298"></a>00298     fcntl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, F_SETFD, FD_CLOEXEC);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <span class="comment">// build device abbreviation</span>
<a name="l00301"></a>00301     memset(this-&gt;<a class="code" href="classMMSFBDev.html#8d4c63660dae3f521da802cc2767af4a" title="device abbreviation">device</a>, 0, <span class="keyword">sizeof</span>(this-&gt;<a class="code" href="classMMSFBDev.html#8d4c63660dae3f521da802cc2767af4a" title="device abbreviation">device</a>));
<a name="l00302"></a>00302     sprintf(this-&gt;<a class="code" href="classMMSFBDev.html#8d4c63660dae3f521da802cc2767af4a" title="device abbreviation">device</a>, <span class="stringliteral">"fb0"</span>);
<a name="l00303"></a>00303     <span class="keywordflow">if</span> (this-&gt;device_file.substr(0, 8) == <span class="stringliteral">"/dev/fb/"</span>)
<a name="l00304"></a>00304         sprintf(this-&gt;<a class="code" href="classMMSFBDev.html#8d4c63660dae3f521da802cc2767af4a" title="device abbreviation">device</a>, <span class="stringliteral">"fb%s"</span>, this-&gt;device_file.substr(8, 5).c_str());
<a name="l00305"></a>00305     <span class="keywordflow">else</span>
<a name="l00306"></a>00306     <span class="keywordflow">if</span> (this-&gt;device_file.substr(0, 7) == <span class="stringliteral">"/dev/fb"</span>)
<a name="l00307"></a>00307         sprintf(this-&gt;<a class="code" href="classMMSFBDev.html#8d4c63660dae3f521da802cc2767af4a" title="device abbreviation">device</a>, <span class="stringliteral">"fb%s"</span>, this-&gt;device_file.substr(7, 5).c_str());
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="comment">// read video modes</span>
<a name="l00310"></a>00310     <a class="code" href="classMMSFBDev.html#8f561615fe7dd64263a001a9ec4a7bba">readModes</a>();
<a name="l00311"></a>00311     printf(<span class="stringliteral">"MMSFBDev: %d modes loaded from /etc/fb.modes\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#f4fa59e1da4a6db81ef67f569b2cbecd" title="number of loaded modes">modes_cnt</a>);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <span class="comment">// initialize virtual terminal</span>
<a name="l00314"></a>00314     <span class="keywordflow">if</span> (console &gt;= -1)
<a name="l00315"></a>00315         <span class="keywordflow">if</span> (!<a class="code" href="classMMSFBDev.html#c124e2917e22b76ab38abc5d20ff961b">vtOpen</a>(console)) {
<a name="l00316"></a>00316             <a class="code" href="classMMSFBDev.html#1512ce90aefefe883d165ffa1c5b304f">closeDevice</a>();
<a name="l00317"></a>00317             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="comment">// get fix screen infos</span>
<a name="l00321"></a>00321     <span class="keywordflow">if</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="fb_8h.html#692fc640698d6b00cd291f2b1ce1b1b8">FBIOGET_FSCREENINFO</a>, &amp;this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>) &lt; 0) {
<a name="l00322"></a>00322         printf(<span class="stringliteral">"MMSFBDev: could not get fix screen infos from %s\n"</span>, this-&gt;device_file.c_str());
<a name="l00323"></a>00323         <a class="code" href="classMMSFBDev.html#1512ce90aefefe883d165ffa1c5b304f">closeDevice</a>();
<a name="l00324"></a>00324         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326     <a class="code" href="classMMSFBDev.html#ce4dfa1ff8f302e56e50f3b0bc228f2c">printFixScreenInfo</a>();
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     <span class="comment">// map framebuffer to memory (try shared, if it doesn't work, i.e. on non-mmu based machines, try private)</span>
<a name="l00329"></a>00329     <span class="keywordflow">if</span> ((this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a>=mmap(NULL, this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#f6272eb9ab0711edaa2532758fafef65">smem_len</a>,
<a name="l00330"></a>00330                                      PROT_READ | PROT_WRITE, MAP_SHARED, this-&gt;fd, 0)) == MAP_FAILED) {
<a name="l00331"></a>00331         <span class="keywordflow">if</span> ((this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a>=mmap(NULL, this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#f6272eb9ab0711edaa2532758fafef65">smem_len</a>,
<a name="l00332"></a>00332                                          PROT_READ | PROT_WRITE, MAP_PRIVATE, this-&gt;fd, 0)) == MAP_FAILED) {
<a name="l00333"></a>00333             printf(<span class="stringliteral">"MMSFBDev: could not mmap framebuffer memory for %s\n"</span>, this-&gt;device_file.c_str());
<a name="l00334"></a>00334             this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a> = NULL;
<a name="l00335"></a>00335             <a class="code" href="classMMSFBDev.html#1512ce90aefefe883d165ffa1c5b304f">closeDevice</a>();
<a name="l00336"></a>00336             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00337"></a>00337         }
<a name="l00338"></a>00338     }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="comment">// get variable screen infos</span>
<a name="l00341"></a>00341     <span class="keywordflow">if</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="fb_8h.html#140bb702dad2959090d3117088b3b412">FBIOGET_VSCREENINFO</a>, &amp;this-&gt;<a class="code" href="classMMSFBDev.html#e0a8505ab3435de34e2c1270f260cf56" title="original variable screen infos">org_var_screeninfo</a>) &lt; 0) {
<a name="l00342"></a>00342         printf(<span class="stringliteral">"MMSFBDev: could not get var screen infos from %s\n"</span>, this-&gt;device_file.c_str());
<a name="l00343"></a>00343         <a class="code" href="classMMSFBDev.html#1512ce90aefefe883d165ffa1c5b304f">closeDevice</a>();
<a name="l00344"></a>00344         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="comment">// disable console acceleration</span>
<a name="l00348"></a>00348     this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a> = this-&gt;<a class="code" href="classMMSFBDev.html#e0a8505ab3435de34e2c1270f260cf56" title="original variable screen infos">org_var_screeninfo</a>;
<a name="l00349"></a>00349     this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#262518fdf525633779513d3a5c772b49">accel_flags</a> = 0;
<a name="l00350"></a>00350     <span class="keywordflow">if</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="fb_8h.html#17ec7c2cf2f365da211bc8697de28860">FBIOPUT_VSCREENINFO</a>, &amp;this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>) &lt; 0) {
<a name="l00351"></a>00351         printf(<span class="stringliteral">"MMSFBDev: could not disable console acceleration for %s\n"</span>, this-&gt;device_file.c_str());
<a name="l00352"></a>00352         <a class="code" href="classMMSFBDev.html#1512ce90aefefe883d165ffa1c5b304f">closeDevice</a>();
<a name="l00353"></a>00353         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00354"></a>00354     }
<a name="l00355"></a>00355     <a class="code" href="classMMSFBDev.html#a56d804fbfbd26ff16978a272283a8ab">printVarScreenInfo</a>();
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="comment">// build the preset pixelformat</span>
<a name="l00358"></a>00358     <a class="code" href="classMMSFBDev.html#e4e339e84b5d70da214e6ece641f63d0">buildPixelFormat</a>();
<a name="l00359"></a>00359 
<a name="l00360"></a>00360     <span class="comment">// all initialized :)</span>
<a name="l00361"></a>00361     this-&gt;<a class="code" href="classMMSFBDev.html#3b42ac577cc48a05b3546df72d12b279" title="is initialized?">isinitialized</a> = <span class="keyword">true</span>;
<a name="l00362"></a>00362 
<a name="l00363"></a>00363     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00366"></a><a class="code" href="classMMSFBDev.html#1512ce90aefefe883d165ffa1c5b304f">00366</a> <span class="keywordtype">void</span> <a class="code" href="classMMSFBDev.html#1512ce90aefefe883d165ffa1c5b304f">MMSFBDev::closeDevice</a>() {
<a name="l00367"></a>00367     <span class="comment">// reset virtual terminal</span>
<a name="l00368"></a>00368     <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l00369"></a>00369 
<a name="l00370"></a>00370     <span class="comment">// free resources if allocated</span>
<a name="l00371"></a>00371     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#005c5f72dedd7fa92e37356620d8b566" title="have to reset the console acceleration">reset_console_accel</a>) {
<a name="l00372"></a>00372         <span class="comment">// reset console acceleration</span>
<a name="l00373"></a>00373         ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="fb_8h.html#17ec7c2cf2f365da211bc8697de28860">FBIOPUT_VSCREENINFO</a>, &amp;this-&gt;<a class="code" href="classMMSFBDev.html#e0a8505ab3435de34e2c1270f260cf56" title="original variable screen infos">org_var_screeninfo</a>);
<a name="l00374"></a>00374         this-&gt;<a class="code" href="classMMSFBDev.html#005c5f72dedd7fa92e37356620d8b566" title="have to reset the console acceleration">reset_console_accel</a> = <span class="keyword">false</span>;
<a name="l00375"></a>00375     }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a>) {
<a name="l00378"></a>00378         munmap(this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a>, this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#f6272eb9ab0711edaa2532758fafef65">smem_len</a>);
<a name="l00379"></a>00379         this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a> = NULL;
<a name="l00380"></a>00380     }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a> != -1) {
<a name="l00383"></a>00383         close(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>);
<a name="l00384"></a>00384         this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a> = -1;
<a name="l00385"></a>00385     }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     <span class="comment">// reset all other</span>
<a name="l00388"></a>00388     this-&gt;<a class="code" href="classMMSFBDev.html#3b42ac577cc48a05b3546df72d12b279" title="is initialized?">isinitialized</a> = <span class="keyword">false</span>;
<a name="l00389"></a>00389     memset(this-&gt;<a class="code" href="classMMSFBDev.html#35d279c05e38dea2c6f6932af9306adb" title="available modes read from /etc/fb.modes">modes</a>, 0, <span class="keyword">sizeof</span>(this-&gt;<a class="code" href="classMMSFBDev.html#35d279c05e38dea2c6f6932af9306adb" title="available modes read from /etc/fb.modes">modes</a>));
<a name="l00390"></a>00390     this-&gt;<a class="code" href="classMMSFBDev.html#f4fa59e1da4a6db81ef67f569b2cbecd" title="number of loaded modes">modes_cnt</a> = 0;
<a name="l00391"></a>00391     memset(this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>, 0, <span class="keyword">sizeof</span>(this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>));
<a name="l00392"></a>00392     this-&gt;<a class="code" href="classMMSFBDev.html#38e7c26220d4e667e01561d2aef2b9ff" title="number of layers">layers_cnt</a> = 0;
<a name="l00393"></a>00393     this-&gt;<a class="code" href="classMMSFBDev.html#ac7d9655a7c8d5684168da2aea290847" title="id of the active screen (this is for fbs != vesa)">active_screen</a> = 0;
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 
<a name="l00396"></a><a class="code" href="classMMSFBDev.html#f827b8f395ba3c7d27bbb578c778c026">00396</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#f827b8f395ba3c7d27bbb578c778c026">MMSFBDev::isInitialized</a>() {
<a name="l00397"></a>00397     <span class="keywordflow">return</span> this-&gt;<a class="code" href="classMMSFBDev.html#3b42ac577cc48a05b3546df72d12b279" title="is initialized?">isinitialized</a>;
<a name="l00398"></a>00398 }
<a name="l00399"></a>00399 
<a name="l00400"></a><a class="code" href="classMMSFBDev.html#9ec2c4bd51dd26c6bdbe71c5ebdf9f51">00400</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#9ec2c4bd51dd26c6bdbe71c5ebdf9f51">MMSFBDev::waitForVSync</a>() {
<a name="l00401"></a>00401     <span class="comment">// is initialized?</span>
<a name="l00402"></a>00402     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404     <span class="comment">// default fbdev does support only primary screen 0</span>
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#ac7d9655a7c8d5684168da2aea290847" title="id of the active screen (this is for fbs != vesa)">active_screen</a> != 0) {
<a name="l00406"></a>00406         printf(<span class="stringliteral">"MMSFBDev: screen %d is not supported\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#ac7d9655a7c8d5684168da2aea290847" title="id of the active screen (this is for fbs != vesa)">active_screen</a>);
<a name="l00407"></a>00407         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> s = 0;
<a name="l00411"></a>00411     <span class="keywordflow">if</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="mmsfbdev_8h.html#d169cbc3efb007545485b3ca1b5d7e6a">FBIO_WAITFORVSYNC</a>, &amp;s)) {
<a name="l00412"></a>00412         <span class="comment">// failed, well then???</span>
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00416"></a>00416 }
<a name="l00417"></a>00417 
<a name="l00418"></a><a class="code" href="classMMSFBDev.html#9c3327f031e7de4364900966bc716207">00418</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#9c3327f031e7de4364900966bc716207">MMSFBDev::panDisplay</a>(<span class="keywordtype">int</span> buffer_id, <span class="keywordtype">void</span> *<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a>) {
<a name="l00419"></a>00419     <span class="comment">// is initialized?</span>
<a name="l00420"></a>00420     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <span class="comment">// check framebuffer_base pointer</span>
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (framebuffer_base) {
<a name="l00424"></a>00424         <span class="keywordflow">if</span> (framebuffer_base != this-&gt;framebuffer_base) {
<a name="l00425"></a>00425             printf(<span class="stringliteral">"MMSFBDev: framebuffer base pointer not correct\n"</span>);
<a name="l00426"></a>00426             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00427"></a>00427         }
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="comment">// calc new y offset</span>
<a name="l00431"></a>00431     <span class="keywordtype">int</span> <a class="code" href="structfb__var__screeninfo.html#7cde086a03e8f02a172096c772841b9d">yoffset</a> = buffer_id * this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>;
<a name="l00432"></a>00432     <span class="keywordflow">if</span> ((yoffset &lt; 0) || (yoffset + this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a> &gt; this-&gt;var_screeninfo.yres_virtual)) {
<a name="l00433"></a>00433         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435     <span class="keywordtype">int</span> xoffset_save = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#137e1c4baafbdaeb3148943e8b2cddc6">xoffset</a>;
<a name="l00436"></a>00436     <span class="keywordtype">int</span> yoffset_save = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#7cde086a03e8f02a172096c772841b9d">yoffset</a>;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     <span class="comment">// set new x/y offsets</span>
<a name="l00439"></a>00439     this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#137e1c4baafbdaeb3148943e8b2cddc6">xoffset</a> = 0;
<a name="l00440"></a>00440     this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#7cde086a03e8f02a172096c772841b9d">yoffset</a> = yoffset;
<a name="l00441"></a>00441     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#10941d6d21cd86a2517dddeff8cd5355">ypanstep</a>)
<a name="l00442"></a>00442         this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#2634d06c75d3919e39aff615cc428427">vmode</a> &amp;= ~<a class="code" href="fb_8h.html#767964db5d0dc7ca9f7bef23b9494646">FB_VMODE_YWRAP</a>;
<a name="l00443"></a>00443     <span class="keywordflow">else</span>
<a name="l00444"></a>00444         this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#2634d06c75d3919e39aff615cc428427">vmode</a> |= <a class="code" href="fb_8h.html#767964db5d0dc7ca9f7bef23b9494646">FB_VMODE_YWRAP</a>;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <span class="comment">// switch display</span>
<a name="l00447"></a>00447     this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#79a05843d2117209fdc5953e5b93776b">activate</a> = <a class="code" href="fb_8h.html#42a65e56d800ebd66bd82d8f8d7ff8c0">FB_ACTIVATE_VBL</a>;
<a name="l00448"></a>00448     <span class="keywordflow">if</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="fb_8h.html#ecf4c24ba1829e6b29e97cccdb8502b5">FBIOPAN_DISPLAY</a>, &amp;this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>) &lt; 0) {
<a name="l00449"></a>00449         printf(<span class="stringliteral">"MMSFBDev: display panning not supported\n"</span>);
<a name="l00450"></a>00450         this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#137e1c4baafbdaeb3148943e8b2cddc6">xoffset</a> = xoffset_save;
<a name="l00451"></a>00451         this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#7cde086a03e8f02a172096c772841b9d">yoffset</a> = yoffset_save;
<a name="l00452"></a>00452         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00456"></a>00456 }
<a name="l00457"></a>00457 
<a name="l00458"></a><a class="code" href="classMMSFBDev.html#25b49a8ef968a5cca5dbbff4c9db9860">00458</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#25b49a8ef968a5cca5dbbff4c9db9860">MMSFBDev::testLayer</a>(<span class="keywordtype">int</span> layer_id) {
<a name="l00459"></a>00459     <span class="comment">// is initialized?</span>
<a name="l00460"></a>00460     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     <span class="comment">// default fbdev does support only primary layer 0 on primary screen 0</span>
<a name="l00463"></a>00463     <span class="keywordflow">if</span> (layer_id != 0) {
<a name="l00464"></a>00464         printf(<span class="stringliteral">"MMSFBDev: layer %d is not supported\n"</span>, layer_id);
<a name="l00465"></a>00465         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00466"></a>00466     }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="classMMSFBDev.html#b41bbd054dd9ad4fc7a4c8c2d3e12576">00471</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#b41bbd054dd9ad4fc7a4c8c2d3e12576">MMSFBDev::initLayer</a>(<span class="keywordtype">int</span> layer_id, <span class="keywordtype">int</span> <a class="code" href="structfb__var__screeninfo.html#47007ea3bae58683c62588cfe49dc323">width</a>, <span class="keywordtype">int</span> <a class="code" href="structfb__var__screeninfo.html#f70eb3a1a12cb198ee00fb0ac07d783d">height</a>, <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb" title="supported pixel formats">MMSFBSurfacePixelFormat</a> pixelformat, <span class="keywordtype">int</span> backbuffer) {
<a name="l00472"></a>00472     <span class="comment">// is initialized?</span>
<a name="l00473"></a>00473     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475     <span class="comment">// default fbdev does support only primary layer 0 on primary screen 0</span>
<a name="l00476"></a>00476     <span class="keywordflow">if</span> (layer_id != 0) {
<a name="l00477"></a>00477         printf(<span class="stringliteral">"MMSFBDev: layer %d is not supported\n"</span>, layer_id);
<a name="l00478"></a>00478         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00479"></a>00479     }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481     <span class="comment">//switch video mode</span>
<a name="l00482"></a>00482     <span class="keywordflow">if</span> (!<a class="code" href="classMMSFBDev.html#de5be932cbe44aea9e8a0994c6852863">setMode</a>(width, height, pixelformat, backbuffer))
<a name="l00483"></a>00483         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485     <span class="keywordflow">if</span> (width &lt;= 0 || height &lt;= 0) {
<a name="l00486"></a>00486         <span class="comment">// the layer is disabled now</span>
<a name="l00487"></a>00487         this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#b0fa5cabc86bff61a7dc6209d58074f3" title="is initialized?">isinitialized</a> = <span class="keyword">false</span>;
<a name="l00488"></a>00488         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     <span class="comment">// save dimension of the layer</span>
<a name="l00492"></a>00492     this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#edb1e711473e01db7928234bea98d906" title="width of the layer">width</a> = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>;
<a name="l00493"></a>00493     this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#5684affe8f50999e2a2e195591d81406" title="height of the layer">height</a> = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>;
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     <span class="comment">// save the buffers</span>
<a name="l00496"></a>00496     memset(&amp;this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].buffers, 0, <span class="keyword">sizeof</span>(this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].buffers));
<a name="l00497"></a>00497     <span class="keywordflow">switch</span> (backbuffer) {
<a name="l00498"></a>00498     <span class="keywordflow">case</span> 2:
<a name="l00499"></a>00499         this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#05a08873b8f59f188e0a26bc91c9dbd6" title="describes the surface buffers">buffers</a>[2].ptr  = ((<span class="keywordtype">char</span> *)this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a>)
<a name="l00500"></a>00500                                                 + 2 * this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#7131a5355e595cd09772d29663afdd00">line_length</a> * this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>;
<a name="l00501"></a>00501         this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#05a08873b8f59f188e0a26bc91c9dbd6" title="describes the surface buffers">buffers</a>[2].pitch= this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#7131a5355e595cd09772d29663afdd00">line_length</a>;
<a name="l00502"></a>00502         this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#05a08873b8f59f188e0a26bc91c9dbd6" title="describes the surface buffers">buffers</a>[2].hwbuffer = <span class="keyword">true</span>;
<a name="l00503"></a>00503     <span class="keywordflow">case</span> 1:
<a name="l00504"></a>00504         this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#05a08873b8f59f188e0a26bc91c9dbd6" title="describes the surface buffers">buffers</a>[1].ptr  = ((<span class="keywordtype">char</span> *)this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a>)
<a name="l00505"></a>00505                                                  + this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#7131a5355e595cd09772d29663afdd00">line_length</a> * this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>;
<a name="l00506"></a>00506         this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#05a08873b8f59f188e0a26bc91c9dbd6" title="describes the surface buffers">buffers</a>[1].pitch= this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#7131a5355e595cd09772d29663afdd00">line_length</a>;
<a name="l00507"></a>00507         this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#05a08873b8f59f188e0a26bc91c9dbd6" title="describes the surface buffers">buffers</a>[1].hwbuffer = <span class="keyword">true</span>;
<a name="l00508"></a>00508     <span class="keywordflow">case</span> 0:
<a name="l00509"></a>00509         this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#05a08873b8f59f188e0a26bc91c9dbd6" title="describes the surface buffers">buffers</a>[0].ptr  = this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a>;
<a name="l00510"></a>00510         this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#05a08873b8f59f188e0a26bc91c9dbd6" title="describes the surface buffers">buffers</a>[0].pitch= this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#7131a5355e595cd09772d29663afdd00">line_length</a>;
<a name="l00511"></a>00511         this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#05a08873b8f59f188e0a26bc91c9dbd6" title="describes the surface buffers">buffers</a>[0].hwbuffer = <span class="keyword">true</span>;
<a name="l00512"></a>00512         <span class="keywordflow">break</span>;
<a name="l00513"></a>00513     <span class="keywordflow">default</span>:
<a name="l00514"></a>00514         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517     <span class="comment">// layer is initialized</span>
<a name="l00518"></a>00518     this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#b0fa5cabc86bff61a7dc6209d58074f3" title="is initialized?">isinitialized</a> = <span class="keyword">true</span>;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     <span class="comment">// this layer is on screen 0 (default)</span>
<a name="l00521"></a>00521     this-&gt;<a class="code" href="classMMSFBDev.html#ac7d9655a7c8d5684168da2aea290847" title="id of the active screen (this is for fbs != vesa)">active_screen</a> = 0;
<a name="l00522"></a>00522 
<a name="l00523"></a>00523     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525 
<a name="l00526"></a><a class="code" href="classMMSFBDev.html#e0f9c140596bfc2304dd718497f39948">00526</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#e0f9c140596bfc2304dd718497f39948">MMSFBDev::releaseLayer</a>(<span class="keywordtype">int</span> layer_id) {
<a name="l00527"></a>00527     printf(<span class="stringliteral">"MMSFBDev: layer %d cannot be released\n"</span>, layer_id);
<a name="l00528"></a>00528     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00529"></a>00529 }
<a name="l00530"></a>00530 
<a name="l00531"></a><a class="code" href="classMMSFBDev.html#6bc46ae2b15b2b47f8f0c381fbb4b445">00531</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#6bc46ae2b15b2b47f8f0c381fbb4b445">MMSFBDev::restoreLayer</a>(<span class="keywordtype">int</span> layer_id) {
<a name="l00532"></a>00532     printf(<span class="stringliteral">"MMSFBDev: layer %d cannot be restored\n"</span>, layer_id);
<a name="l00533"></a>00533     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00534"></a>00534 }
<a name="l00535"></a>00535 
<a name="l00536"></a><a class="code" href="classMMSFBDev.html#d64edf9444404248160b8f514d0787f2">00536</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#d64edf9444404248160b8f514d0787f2">MMSFBDev::getPixelFormat</a>(<span class="keywordtype">int</span> layer_id, <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb" title="supported pixel formats">MMSFBSurfacePixelFormat</a> *pf) {
<a name="l00537"></a>00537     <span class="comment">// is initialized?</span>
<a name="l00538"></a>00538     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540     <span class="comment">// is layer initialized?</span>
<a name="l00541"></a>00541     <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="classMMSFBDev.html#3b42ac577cc48a05b3546df72d12b279" title="is initialized?">isinitialized</a>)
<a name="l00542"></a>00542         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544     <span class="comment">// return pixelformat</span>
<a name="l00545"></a>00545     *pf = this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#42ca66c9133a0176a00860f64a552eb6" title="pixelformat of the layer">pixelformat</a>;
<a name="l00546"></a>00546     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a><a class="code" href="classMMSFBDev.html#c31fa606a2d830ce79f875b4e6b165cb">00549</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#c31fa606a2d830ce79f875b4e6b165cb">MMSFBDev::getPhysicalMemory</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *mem) {
<a name="l00550"></a>00550     <span class="comment">// is initialized?</span>
<a name="l00551"></a>00551     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00552"></a>00552     *mem = this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#2d6b15a9cc46b488b05eb30003c76b4a">smem_start</a>;
<a name="l00553"></a>00553     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00554"></a>00554 }
<a name="l00555"></a>00555 
<a name="l00556"></a><a class="code" href="classMMSFBDev.html#ac3ee2ddfb7a061866c7386a879d5352">00556</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#ac3ee2ddfb7a061866c7386a879d5352">MMSFBDev::getFrameBufferBase</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **base) {
<a name="l00557"></a>00557     <span class="comment">// is initialized?</span>
<a name="l00558"></a>00558     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00559"></a>00559     *base = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)this-&gt;<a class="code" href="classMMSFBDev.html#1c00f0d49e8d91d2e393e9485a13ac73" title="virtual framebuffer address">framebuffer_base</a>;
<a name="l00560"></a>00560     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00561"></a>00561 }
<a name="l00562"></a>00562 
<a name="l00563"></a><a class="code" href="classMMSFBDev.html#392fa1faca2e107137cfe7d30bded002">00563</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#392fa1faca2e107137cfe7d30bded002">MMSFBDev::getFrameBufferPtr</a>(<span class="keywordtype">int</span> layer_id, <a class="code" href="mmstypes_8h.html#c52f6dd2306c03f62ddc2f6f38a91957" title="describes multiple buffers for backbuffer/triple buffer handling">MMSFBSurfacePlanesBuffer</a> buffers, <span class="keywordtype">int</span> *<a class="code" href="structfb__var__screeninfo.html#47007ea3bae58683c62588cfe49dc323">width</a>, <span class="keywordtype">int</span> *<a class="code" href="structfb__var__screeninfo.html#f70eb3a1a12cb198ee00fb0ac07d783d">height</a>) {
<a name="l00564"></a>00564     <span class="comment">// is initialized?</span>
<a name="l00565"></a>00565     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00566"></a>00566 
<a name="l00567"></a>00567     <span class="comment">// is layer initialized?</span>
<a name="l00568"></a>00568     <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="classMMSFBDev.html#3b42ac577cc48a05b3546df72d12b279" title="is initialized?">isinitialized</a>) {
<a name="l00569"></a>00569         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="comment">// return buffer infos</span>
<a name="l00573"></a>00573     <span class="keywordflow">if</span> (buffers)
<a name="l00574"></a>00574         memcpy(buffers, this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].buffers, <span class="keyword">sizeof</span>(this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].buffers));
<a name="l00575"></a>00575     *width = this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#edb1e711473e01db7928234bea98d906" title="width of the layer">width</a>;
<a name="l00576"></a>00576     *height = this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[layer_id].<a class="code" href="structMMSFBDev_1_1MMSFBDEV__LAYER.html#5684affe8f50999e2a2e195591d81406" title="height of the layer">height</a>;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00579"></a>00579 }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 
<a name="l00582"></a><a class="code" href="classMMSFBDev.html#b32c306778ffb8a9b41d3d4918a0f107">00582</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#b32c306778ffb8a9b41d3d4918a0f107">MMSFBDev::mapMmio</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> **mmio) {
<a name="l00583"></a>00583     <span class="comment">// is initialized?</span>
<a name="l00584"></a>00584     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586     *mmio = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)mmap(NULL, this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#5fb1aa292e1ed70f714179a2d71ba207">mmio_len</a>, PROT_READ | PROT_WRITE, MAP_SHARED,
<a name="l00587"></a>00587                                   this-&gt;fd, this-&gt;fix_screeninfo.smem_len);
<a name="l00588"></a>00588     <span class="keywordflow">if</span> (!*mmio) {
<a name="l00589"></a>00589         printf(<span class="stringliteral">"MMSFBDev: could not mmap mmio buffer\n"</span>);
<a name="l00590"></a>00590         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     <span class="keywordtype">long</span> page_size = sysconf(_SC_PAGESIZE);
<a name="l00594"></a>00594     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> page_mask = page_size &lt; 0 ? 0 : (page_size - 1);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596     *mmio = (*mmio) + (this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#401d77fa4f32c1f8572d31a22e21f04c">mmio_start</a> &amp; page_mask);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 
<a name="l00601"></a><a class="code" href="classMMSFBDev.html#358be5b0e5c844aff9d27e61e5f4fe44">00601</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#358be5b0e5c844aff9d27e61e5f4fe44">MMSFBDev::unmapMmio</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *mmio) {
<a name="l00602"></a>00602     <span class="comment">// is initialized?</span>
<a name="l00603"></a>00603     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     <span class="keywordtype">long</span> page_size = sysconf(_SC_PAGESIZE);
<a name="l00606"></a>00606     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> page_mask = page_size &lt; 0 ? 0 : (page_size - 1);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608     munmap((<span class="keywordtype">void</span>*)(mmio - (this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#401d77fa4f32c1f8572d31a22e21f04c">mmio_start</a> &amp; page_mask)), this-&gt;fix_screeninfo.mmio_len);
<a name="l00609"></a>00609 
<a name="l00610"></a>00610     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a><a class="code" href="classMMSFBDev.html#1a9b3de7d5ae87e20b37589a429f4c9e">00613</a> <span class="keywordtype">void</span> <a class="code" href="classMMSFBDev.html#1a9b3de7d5ae87e20b37589a429f4c9e">MMSFBDev::genFBPixelFormat</a>(<a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb" title="supported pixel formats">MMSFBSurfacePixelFormat</a> pf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *nonstd_format, <a class="code" href="structMMSFBPixelDef.html">MMSFBPixelDef</a> *pixeldef) {
<a name="l00614"></a>00614 
<a name="l00615"></a>00615     <span class="comment">// generate std format</span>
<a name="l00616"></a>00616     <span class="keywordflow">if</span> (nonstd_format) *nonstd_format = 0;
<a name="l00617"></a>00617     <a class="code" href="mmsfbbase_8h.html#df60de45ed69bf58eee7c5f982a4da90">getBitsPerPixel</a>(pf, pixeldef);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619     <span class="comment">// try to get a fb specific format</span>
<a name="l00620"></a>00620     this-&gt;<a class="code" href="classMMSFBDev.html#52e975a48cc0ec63fa1ee1f8518c71ba">onGenFBPixelFormat</a>.emit(pf, nonstd_format, pixeldef);
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
<a name="l00623"></a><a class="code" href="classMMSFBDev.html#aa8542e9bb5f1df24c03e1f725fcc603">00623</a> <span class="keywordtype">void</span> <a class="code" href="classMMSFBDev.html#aa8542e9bb5f1df24c03e1f725fcc603">MMSFBDev::disable</a>(<span class="keywordtype">int</span> <a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <span class="keywordtype">string</span> <a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>) {
<a name="l00624"></a>00624     <span class="comment">// have to disable the framebuffer</span>
<a name="l00625"></a>00625     <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classMMSFBDev.html#485b92b6660ad7ace88779e1a501eece">onDisable</a>.emit(fd, device_file)) {
<a name="l00626"></a>00626         <span class="comment">// use FBIOPUT_VSCREENINFO and FBIOBLANK together</span>
<a name="l00627"></a>00627         <span class="keyword">struct </span><a class="code" href="structfb__var__screeninfo.html">fb_var_screeninfo</a> var_screeninfo;
<a name="l00628"></a>00628         ioctl(fd, <a class="code" href="fb_8h.html#140bb702dad2959090d3117088b3b412">FBIOGET_VSCREENINFO</a>, &amp;var_screeninfo);
<a name="l00629"></a>00629         var_screeninfo.<a class="code" href="structfb__var__screeninfo.html#79a05843d2117209fdc5953e5b93776b">activate</a> = <a class="code" href="fb_8h.html#dd1a1848988906df62e5426a0c788186">FB_ACTIVATE_NOW</a>;
<a name="l00630"></a>00630         var_screeninfo.<a class="code" href="structfb__var__screeninfo.html#262518fdf525633779513d3a5c772b49">accel_flags</a> = 0;
<a name="l00631"></a>00631         var_screeninfo.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a> = 0;
<a name="l00632"></a>00632         var_screeninfo.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a> = 0;
<a name="l00633"></a>00633         var_screeninfo.<a class="code" href="structfb__var__screeninfo.html#51132691fa95f57c448db6af35f0b884">xres_virtual</a> = 0;
<a name="l00634"></a>00634         var_screeninfo.<a class="code" href="structfb__var__screeninfo.html#5eba4164bc628e5dc7b1c2591e0101c4">yres_virtual</a> = 0;
<a name="l00635"></a>00635         var_screeninfo.<a class="code" href="structfb__var__screeninfo.html#137e1c4baafbdaeb3148943e8b2cddc6">xoffset</a> = 0;
<a name="l00636"></a>00636         var_screeninfo.<a class="code" href="structfb__var__screeninfo.html#7cde086a03e8f02a172096c772841b9d">yoffset</a> = 0;
<a name="l00637"></a>00637         var_screeninfo.<a class="code" href="structfb__var__screeninfo.html#edb2c5242b9bb987df7ab05dd982424c">grayscale</a> = 0;
<a name="l00638"></a>00638         ioctl(fd, <a class="code" href="fb_8h.html#17ec7c2cf2f365da211bc8697de28860">FBIOPUT_VSCREENINFO</a>, &amp;var_screeninfo);
<a name="l00639"></a>00639         ioctl(fd, <a class="code" href="fb_8h.html#2e9785ea13352724cda5c8f6d91c47c5">FBIOBLANK</a>, 1);
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641 }
<a name="l00642"></a>00642 
<a name="l00643"></a><a class="code" href="classMMSFBDev.html#19f9bdfb8e81e276631a89fbab64fb24">00643</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#19f9bdfb8e81e276631a89fbab64fb24">MMSFBDev::activate</a>(<span class="keywordtype">int</span> <a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <span class="keywordtype">string</span> <a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>, <span class="keyword">struct</span> <a class="code" href="structfb__var__screeninfo.html">fb_var_screeninfo</a> *<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>,
<a name="l00644"></a>00644                         <span class="keywordtype">int</span> <a class="code" href="structfb__var__screeninfo.html#47007ea3bae58683c62588cfe49dc323">width</a>, <span class="keywordtype">int</span> <a class="code" href="structfb__var__screeninfo.html#f70eb3a1a12cb198ee00fb0ac07d783d">height</a>, <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb" title="supported pixel formats">MMSFBSurfacePixelFormat</a> pixelformat, <span class="keywordtype">bool</span> switch_mode) {
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     <span class="comment">// try callback</span>
<a name="l00647"></a>00647     <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classMMSFBDev.html#f2a041386682903f6ace0c82da07e513">onActivate</a>.emit(fd, device_file, var_screeninfo, width, height, pixelformat, switch_mode)) {
<a name="l00648"></a>00648         <span class="comment">// no callback set or callback failed</span>
<a name="l00649"></a>00649         <span class="keywordflow">if</span> (switch_mode) {
<a name="l00650"></a>00650             <span class="keywordflow">if</span> (ioctl(fd, <a class="code" href="fb_8h.html#17ec7c2cf2f365da211bc8697de28860">FBIOPUT_VSCREENINFO</a>, var_screeninfo) &lt; 0) {
<a name="l00651"></a>00651                 printf(<span class="stringliteral">"MMSFBDev: could not switch to mode %dx%d, pixelformat %s (%d bits, nonstd %d), %s\n"</span>,
<a name="l00652"></a>00652                         width, height, <a class="code" href="mmstypes_8h.html#6727c4c364ac2d2ff384ac40cea47b17">getMMSFBPixelFormatString</a>(pixelformat).c_str(),
<a name="l00653"></a>00653                         var_screeninfo-&gt;<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a>, var_screeninfo-&gt;<a class="code" href="structfb__var__screeninfo.html#f52fb6a7f76db38e1815d854fc16b018">nonstd</a>,
<a name="l00654"></a>00654                         device_file.c_str());
<a name="l00655"></a>00655                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00656"></a>00656             }
<a name="l00657"></a>00657         }
<a name="l00658"></a>00658     }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660     <span class="comment">// get fix screen infos</span>
<a name="l00661"></a>00661     <span class="keywordflow">if</span> (ioctl(this-&gt;fd, <a class="code" href="fb_8h.html#692fc640698d6b00cd291f2b1ce1b1b8">FBIOGET_FSCREENINFO</a>, &amp;this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>) &lt; 0) {
<a name="l00662"></a>00662         printf(<span class="stringliteral">"MMSFBDev: could not get fix screen infos from %s\n"</span>, this-&gt;device_file.c_str());
<a name="l00663"></a>00663         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665     <a class="code" href="classMMSFBDev.html#ce4dfa1ff8f302e56e50f3b0bc228f2c">printFixScreenInfo</a>();
<a name="l00666"></a>00666 
<a name="l00667"></a>00667     <span class="comment">// get variable screen infos</span>
<a name="l00668"></a>00668     <span class="keywordflow">if</span> (ioctl(this-&gt;fd, <a class="code" href="fb_8h.html#140bb702dad2959090d3117088b3b412">FBIOGET_VSCREENINFO</a>, &amp;this-&gt;var_screeninfo) &lt; 0) {
<a name="l00669"></a>00669         printf(<span class="stringliteral">"MMSFBDev: could not get var screen infos from %s\n"</span>, this-&gt;device_file.c_str());
<a name="l00670"></a>00670         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00671"></a>00671     }
<a name="l00672"></a>00672     <a class="code" href="classMMSFBDev.html#a56d804fbfbd26ff16978a272283a8ab">printVarScreenInfo</a>();
<a name="l00673"></a>00673 
<a name="l00674"></a>00674     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00675"></a>00675 }
<a name="l00676"></a>00676 
<a name="l00677"></a><a class="code" href="classMMSFBDev.html#de5be932cbe44aea9e8a0994c6852863">00677</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#de5be932cbe44aea9e8a0994c6852863">MMSFBDev::setMode</a>(<span class="keywordtype">int</span> <a class="code" href="structfb__var__screeninfo.html#47007ea3bae58683c62588cfe49dc323">width</a>, <span class="keywordtype">int</span> <a class="code" href="structfb__var__screeninfo.html#f70eb3a1a12cb198ee00fb0ac07d783d">height</a>, <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb" title="supported pixel formats">MMSFBSurfacePixelFormat</a> pixelformat, <span class="keywordtype">int</span> backbuffer) {
<a name="l00678"></a>00678     <span class="keywordtype">bool</span> do_switch = <span class="keyword">false</span>;
<a name="l00679"></a>00679 
<a name="l00680"></a>00680     <span class="comment">// is initialized?</span>
<a name="l00681"></a>00681     <a class="code" href="mmsfb_8cpp.html#2475d8f125dae96d07c18629c5f4120d">INITCHECK</a>;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683     <span class="keywordflow">if</span> (width &lt;= 0 || height &lt;= 0) {
<a name="l00684"></a>00684         <span class="comment">// have to disable the framebuffer</span>
<a name="l00685"></a>00685         <a class="code" href="classMMSFBDev.html#aa8542e9bb5f1df24c03e1f725fcc603">disable</a>(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, this-&gt;<a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>);
<a name="l00686"></a>00686         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00687"></a>00687     }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     <span class="comment">// reload fix screen infos before changing it</span>
<a name="l00690"></a>00690     <span class="keywordflow">if</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="fb_8h.html#692fc640698d6b00cd291f2b1ce1b1b8">FBIOGET_FSCREENINFO</a>, &amp;this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>) &lt; 0) {
<a name="l00691"></a>00691         printf(<span class="stringliteral">"MMSFBDev: could not get fix screen infos from %s\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>.c_str());
<a name="l00692"></a>00692         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00693"></a>00693     }
<a name="l00694"></a>00694     <a class="code" href="classMMSFBDev.html#ce4dfa1ff8f302e56e50f3b0bc228f2c">printFixScreenInfo</a>();
<a name="l00695"></a>00695 
<a name="l00696"></a>00696     <span class="comment">// reload variable screen infos before changing it</span>
<a name="l00697"></a>00697     <span class="keywordflow">if</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="fb_8h.html#140bb702dad2959090d3117088b3b412">FBIOGET_VSCREENINFO</a>, &amp;this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>) &lt; 0) {
<a name="l00698"></a>00698         printf(<span class="stringliteral">"MMSFBDev: could not get var screen infos from %s\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>.c_str());
<a name="l00699"></a>00699         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701     <a class="code" href="classMMSFBDev.html#a56d804fbfbd26ff16978a272283a8ab">printVarScreenInfo</a>();
<a name="l00702"></a>00702 
<a name="l00703"></a>00703     <span class="keywordflow">if</span> (backbuffer) {
<a name="l00704"></a>00704         <span class="keywordflow">if</span> ((!this-&gt;<a class="code" href="classMMSFBDev.html#08aa58da77939ce2f27154f727c8686c" title="fix screen infos">fix_screeninfo</a>.<a class="code" href="structfb__fix__screeninfo.html#10941d6d21cd86a2517dddeff8cd5355">ypanstep</a>)&amp;&amp;(!this-&gt;fix_screeninfo.ywrapstep)) {
<a name="l00705"></a>00705             printf(<span class="stringliteral">"MMSFBDev: backbuffer requested, but hardware does not support it for %s\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>.c_str());
<a name="l00706"></a>00706             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00707"></a>00707         }
<a name="l00708"></a>00708     }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710     <span class="comment">// get bits per pixel and its length/offset</span>
<a name="l00711"></a>00711     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nonstd_format;
<a name="l00712"></a>00712     <a class="code" href="structMMSFBPixelDef.html">MMSFBPixelDef</a> pixeldef;
<a name="l00713"></a>00713     <a class="code" href="classMMSFBDev.html#1a9b3de7d5ae87e20b37589a429f4c9e">genFBPixelFormat</a>(pixelformat, &amp;nonstd_format, &amp;pixeldef);
<a name="l00714"></a>00714 
<a name="l00715"></a>00715     <span class="comment">// check if mode is already set</span>
<a name="l00716"></a>00716     <span class="keywordflow">if</span> (!nonstd_format) {
<a name="l00717"></a>00717         <span class="comment">// do it only if a std format is requested</span>
<a name="l00718"></a>00718         <span class="keywordflow">if</span>    ((width == (<span class="keywordtype">int</span>)this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>) &amp;&amp; (height == (<span class="keywordtype">int</span>)this-&gt;var_screeninfo.yres)
<a name="l00719"></a>00719             &amp;&amp; (pixeldef.<a class="code" href="structMMSFBPixelDef.html#00eda3c0b4b64bcdaef1f1addd34db7c">bits</a> == (<span class="keywordtype">int</span>)this-&gt;var_screeninfo.bits_per_pixel) &amp;&amp; (this-&gt;layers[0].pixelformat == pixelformat)
<a name="l00720"></a>00720             &amp;&amp; (!backbuffer || (this-&gt;var_screeninfo.yres_virtual &gt;= this-&gt;var_screeninfo.yres * (backbuffer+1)))) {
<a name="l00721"></a>00721             <span class="comment">// mode already set, no switch required</span>
<a name="l00722"></a>00722             printf(<span class="stringliteral">"MMSFBDev: using preset mode %dx%d, pixelformat %s (%d bits), %s\n"</span>,
<a name="l00723"></a>00723                     width, height, <a class="code" href="mmstypes_8h.html#6727c4c364ac2d2ff384ac40cea47b17">getMMSFBPixelFormatString</a>(pixelformat).c_str(), pixeldef.<a class="code" href="structMMSFBPixelDef.html#00eda3c0b4b64bcdaef1f1addd34db7c">bits</a>,
<a name="l00724"></a>00724                     this-&gt;device_file.c_str());
<a name="l00725"></a>00725 
<a name="l00726"></a>00726             <span class="comment">// we have to activate the device (can be disabled), but mode switch is not required</span>
<a name="l00727"></a>00727             <a class="code" href="classMMSFBDev.html#19f9bdfb8e81e276631a89fbab64fb24">activate</a>(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, this-&gt;<a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>, &amp;this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>, width, height, pixelformat, <span class="keyword">false</span>);
<a name="l00728"></a>00728             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00729"></a>00729         }
<a name="l00730"></a>00730     }
<a name="l00731"></a>00731 
<a name="l00732"></a>00732     <span class="keywordflow">if</span> (!do_switch) {
<a name="l00733"></a>00733         <span class="comment">// searching for mode</span>
<a name="l00734"></a>00734         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cnt = 0; cnt &lt; this-&gt;<a class="code" href="classMMSFBDev.html#f4fa59e1da4a6db81ef67f569b2cbecd" title="number of loaded modes">modes_cnt</a>; cnt++) {
<a name="l00735"></a>00735             <span class="keyword">struct </span><a class="code" href="structfb__var__screeninfo.html">fb_var_screeninfo</a> *mode = &amp;this-&gt;<a class="code" href="classMMSFBDev.html#35d279c05e38dea2c6f6932af9306adb" title="available modes read from /etc/fb.modes">modes</a>[cnt];
<a name="l00736"></a>00736             <span class="keywordflow">if</span> ((width == (<span class="keywordtype">int</span>)mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>) &amp;&amp; (height == (<span class="keywordtype">int</span>)mode-&gt;<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>) &amp;&amp; (pixeldef.<a class="code" href="structMMSFBPixelDef.html#00eda3c0b4b64bcdaef1f1addd34db7c">bits</a> == (<span class="keywordtype">int</span>)mode-&gt;<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a>)) {
<a name="l00737"></a>00737                 <span class="comment">// mode matches, switch to it</span>
<a name="l00738"></a>00738                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a> = *mode;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#79a05843d2117209fdc5953e5b93776b">activate</a> = <a class="code" href="fb_8h.html#dd1a1848988906df62e5426a0c788186">FB_ACTIVATE_NOW</a>;
<a name="l00741"></a>00741                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#262518fdf525633779513d3a5c772b49">accel_flags</a> = 0;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f52fb6a7f76db38e1815d854fc16b018">nonstd</a> = nonstd_format;
<a name="l00744"></a>00744 
<a name="l00745"></a>00745                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#fe691325397460b622e505f16400d33a">red_length</a>;
<a name="l00746"></a>00746                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#6f11067342c854d02ffeeead22c2623e">red_offset</a>;
<a name="l00747"></a>00747                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#774e565f546577a2e90a3a83948729bb">green_length</a>;
<a name="l00748"></a>00748                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#5912670bc7f5728de5954b77db46c2f6">green_offset</a>;
<a name="l00749"></a>00749                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#2b0e67706d64a65b8f09dff50e3d0191">blue_length</a>;
<a name="l00750"></a>00750                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#2d5fdd3ab8ddb525df5d45cdd09a58cd">blue_offset</a>;
<a name="l00751"></a>00751                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#61d4784b3011538ed42dd54e0673b9a2">transp</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#730631f432f196896fa13ebd9bf52963">transp_length</a>;
<a name="l00752"></a>00752                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#61d4784b3011538ed42dd54e0673b9a2">transp</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#3ca1c48217c3276d50b3d618f4e647a5">transp_offset</a>;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#51132691fa95f57c448db6af35f0b884">xres_virtual</a> = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>;
<a name="l00755"></a>00755                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5eba4164bc628e5dc7b1c2591e0101c4">yres_virtual</a> = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a> * (backbuffer+1);
<a name="l00756"></a>00756                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#137e1c4baafbdaeb3148943e8b2cddc6">xoffset</a> = 0;
<a name="l00757"></a>00757                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#7cde086a03e8f02a172096c772841b9d">yoffset</a> = 0;
<a name="l00758"></a>00758                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#edb2c5242b9bb987df7ab05dd982424c">grayscale</a> = 0;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760                 do_switch = <span class="keyword">true</span>;
<a name="l00761"></a>00761                 <span class="keywordflow">break</span>;
<a name="l00762"></a>00762             }
<a name="l00763"></a>00763         }
<a name="l00764"></a>00764     }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766     <span class="keywordflow">if</span> (!do_switch) {
<a name="l00767"></a>00767         <span class="comment">// no mode found</span>
<a name="l00768"></a>00768         printf(<span class="stringliteral">"MMSFBDev: no mode %dx%d, bit depth %d (%s) found in /etc/fb.modes\n"</span>,
<a name="l00769"></a>00769                 width, height, pixeldef.<a class="code" href="structMMSFBPixelDef.html#00eda3c0b4b64bcdaef1f1addd34db7c">bits</a>, <a class="code" href="mmstypes_8h.html#6727c4c364ac2d2ff384ac40cea47b17">getMMSFBPixelFormatString</a>(pixelformat).c_str());
<a name="l00770"></a>00770 
<a name="l00771"></a>00771         <span class="comment">// searching for mode with any pixelformat</span>
<a name="l00772"></a>00772         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> cnt = 0; cnt &lt; this-&gt;<a class="code" href="classMMSFBDev.html#f4fa59e1da4a6db81ef67f569b2cbecd" title="number of loaded modes">modes_cnt</a>; cnt++) {
<a name="l00773"></a>00773             <span class="keyword">struct </span><a class="code" href="structfb__var__screeninfo.html">fb_var_screeninfo</a> *mode = &amp;this-&gt;<a class="code" href="classMMSFBDev.html#35d279c05e38dea2c6f6932af9306adb" title="available modes read from /etc/fb.modes">modes</a>[cnt];
<a name="l00774"></a>00774             <span class="keywordflow">if</span> ((width == (<span class="keywordtype">int</span>)mode-&gt;<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>) &amp;&amp; (height == (<span class="keywordtype">int</span>)mode-&gt;<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>)) {
<a name="l00775"></a>00775                 <span class="comment">// mode matches, switch to it</span>
<a name="l00776"></a>00776                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a> = *mode;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778                 printf(<span class="stringliteral">"MMSFBDev: trying to use first mode %dx%d, bit depth %d from /etc/fb.modes\n"</span>, width, height, this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a>);
<a name="l00779"></a>00779 
<a name="l00780"></a>00780                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#79a05843d2117209fdc5953e5b93776b">activate</a> = <a class="code" href="fb_8h.html#dd1a1848988906df62e5426a0c788186">FB_ACTIVATE_NOW</a>;
<a name="l00781"></a>00781                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#262518fdf525633779513d3a5c772b49">accel_flags</a> = 0;
<a name="l00782"></a>00782 
<a name="l00783"></a>00783                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f52fb6a7f76db38e1815d854fc16b018">nonstd</a> = nonstd_format;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#00eda3c0b4b64bcdaef1f1addd34db7c">bits</a>;
<a name="l00786"></a>00786                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#fe691325397460b622e505f16400d33a">red_length</a>;
<a name="l00787"></a>00787                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#6f11067342c854d02ffeeead22c2623e">red_offset</a>;
<a name="l00788"></a>00788                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#774e565f546577a2e90a3a83948729bb">green_length</a>;
<a name="l00789"></a>00789                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#5912670bc7f5728de5954b77db46c2f6">green_offset</a>;
<a name="l00790"></a>00790                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#2b0e67706d64a65b8f09dff50e3d0191">blue_length</a>;
<a name="l00791"></a>00791                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#2d5fdd3ab8ddb525df5d45cdd09a58cd">blue_offset</a>;
<a name="l00792"></a>00792                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#61d4784b3011538ed42dd54e0673b9a2">transp</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#730631f432f196896fa13ebd9bf52963">transp_length</a>;
<a name="l00793"></a>00793                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#61d4784b3011538ed42dd54e0673b9a2">transp</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#3ca1c48217c3276d50b3d618f4e647a5">transp_offset</a>;
<a name="l00794"></a>00794 
<a name="l00795"></a>00795                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#51132691fa95f57c448db6af35f0b884">xres_virtual</a> = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>;
<a name="l00796"></a>00796                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5eba4164bc628e5dc7b1c2591e0101c4">yres_virtual</a> = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a> * (backbuffer+1);
<a name="l00797"></a>00797                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#137e1c4baafbdaeb3148943e8b2cddc6">xoffset</a> = 0;
<a name="l00798"></a>00798                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#7cde086a03e8f02a172096c772841b9d">yoffset</a> = 0;
<a name="l00799"></a>00799                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#edb2c5242b9bb987df7ab05dd982424c">grayscale</a> = 0;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801                 do_switch = <span class="keyword">true</span>;
<a name="l00802"></a>00802                 <span class="keywordflow">break</span>;
<a name="l00803"></a>00803             }
<a name="l00804"></a>00804         }
<a name="l00805"></a>00805     }
<a name="l00806"></a>00806 
<a name="l00807"></a>00807     <span class="keywordflow">if</span> (!do_switch) {
<a name="l00808"></a>00808         <span class="comment">// no mode found</span>
<a name="l00809"></a>00809         printf(<span class="stringliteral">"MMSFBDev: no mode %dx%d with any bit depth found in /etc/fb.modes\n"</span>, width, height);
<a name="l00810"></a>00810 
<a name="l00811"></a>00811         <span class="comment">// check if resolution has changed</span>
<a name="l00812"></a>00812         <span class="keywordflow">if</span>  ((width == (<span class="keywordtype">int</span>)this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>) &amp;&amp; (height == (<span class="keywordtype">int</span>)this-&gt;var_screeninfo.yres)) {
<a name="l00813"></a>00813             <span class="comment">// resolution has not changed, so try to change only the pixelformat</span>
<a name="l00814"></a>00814             printf(<span class="stringliteral">"MMSFBDev: resolution is the same, so try to change the pixelformat to %s, %s\n"</span>,
<a name="l00815"></a>00815                     <a class="code" href="mmstypes_8h.html#6727c4c364ac2d2ff384ac40cea47b17">getMMSFBPixelFormatString</a>(pixelformat).c_str(),
<a name="l00816"></a>00816                     this-&gt;<a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>.c_str());
<a name="l00817"></a>00817 
<a name="l00818"></a>00818             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#79a05843d2117209fdc5953e5b93776b">activate</a> = <a class="code" href="fb_8h.html#dd1a1848988906df62e5426a0c788186">FB_ACTIVATE_NOW</a>;
<a name="l00819"></a>00819             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#262518fdf525633779513d3a5c772b49">accel_flags</a> = 0;
<a name="l00820"></a>00820 
<a name="l00821"></a>00821             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f52fb6a7f76db38e1815d854fc16b018">nonstd</a> = nonstd_format;
<a name="l00822"></a>00822 
<a name="l00823"></a>00823             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#00eda3c0b4b64bcdaef1f1addd34db7c">bits</a>;
<a name="l00824"></a>00824             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#fe691325397460b622e505f16400d33a">red_length</a>;
<a name="l00825"></a>00825             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#6f11067342c854d02ffeeead22c2623e">red_offset</a>;
<a name="l00826"></a>00826             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#774e565f546577a2e90a3a83948729bb">green_length</a>;
<a name="l00827"></a>00827             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#9833949668fa64f31d1e145307817542">green</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#5912670bc7f5728de5954b77db46c2f6">green_offset</a>;
<a name="l00828"></a>00828             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#2b0e67706d64a65b8f09dff50e3d0191">blue_length</a>;
<a name="l00829"></a>00829             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#31a26814ea828584debac212337a3806">blue</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#2d5fdd3ab8ddb525df5d45cdd09a58cd">blue_offset</a>;
<a name="l00830"></a>00830             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#61d4784b3011538ed42dd54e0673b9a2">transp</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#730631f432f196896fa13ebd9bf52963">transp_length</a>;
<a name="l00831"></a>00831             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#61d4784b3011538ed42dd54e0673b9a2">transp</a>.<a class="code" href="structfb__bitfield.html#a69015ebe8cecfcb4dd83aa5eae787e2">offset</a> = pixeldef.<a class="code" href="structMMSFBPixelDef.html#3ca1c48217c3276d50b3d618f4e647a5">transp_offset</a>;
<a name="l00832"></a>00832 
<a name="l00833"></a>00833             <span class="keywordflow">if</span> (backbuffer) {
<a name="l00834"></a>00834                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#51132691fa95f57c448db6af35f0b884">xres_virtual</a> = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>;
<a name="l00835"></a>00835                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5eba4164bc628e5dc7b1c2591e0101c4">yres_virtual</a> = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a> * (backbuffer+1);
<a name="l00836"></a>00836                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#137e1c4baafbdaeb3148943e8b2cddc6">xoffset</a> = 0;
<a name="l00837"></a>00837                 this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#7cde086a03e8f02a172096c772841b9d">yoffset</a> = 0;
<a name="l00838"></a>00838             }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840             do_switch = <span class="keyword">true</span>;
<a name="l00841"></a>00841         }
<a name="l00842"></a>00842         <span class="keywordflow">else</span>
<a name="l00843"></a>00843         <span class="keywordflow">if</span>  (this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].pixelformat == pixelformat) {
<a name="l00844"></a>00844             <span class="comment">// pixelformat has not changed, so try to change only the resolution</span>
<a name="l00845"></a>00845             printf(<span class="stringliteral">"MMSFBDev: pixelformat is the same, so try to change the resolution to %dx%d, %s\n"</span>,
<a name="l00846"></a>00846                     width, height,
<a name="l00847"></a>00847                     this-&gt;<a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>.c_str());
<a name="l00848"></a>00848 
<a name="l00849"></a>00849             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#79a05843d2117209fdc5953e5b93776b">activate</a> = <a class="code" href="fb_8h.html#dd1a1848988906df62e5426a0c788186">FB_ACTIVATE_NOW</a>;
<a name="l00850"></a>00850             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#262518fdf525633779513d3a5c772b49">accel_flags</a> = 0;
<a name="l00851"></a>00851 
<a name="l00852"></a>00852             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a> = width;
<a name="l00853"></a>00853             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a> = height;
<a name="l00854"></a>00854 
<a name="l00855"></a>00855             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#51132691fa95f57c448db6af35f0b884">xres_virtual</a> = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>;
<a name="l00856"></a>00856             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5eba4164bc628e5dc7b1c2591e0101c4">yres_virtual</a> = this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a> * (backbuffer+1);
<a name="l00857"></a>00857             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#137e1c4baafbdaeb3148943e8b2cddc6">xoffset</a> = 0;
<a name="l00858"></a>00858             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#7cde086a03e8f02a172096c772841b9d">yoffset</a> = 0;
<a name="l00859"></a>00859             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#edb2c5242b9bb987df7ab05dd982424c">grayscale</a> = 0;
<a name="l00860"></a>00860 
<a name="l00861"></a>00861             do_switch = <span class="keyword">true</span>;
<a name="l00862"></a>00862         }
<a name="l00863"></a>00863     }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865     <span class="keywordflow">if</span> (do_switch) {
<a name="l00866"></a>00866         <span class="comment">// switch now</span>
<a name="l00867"></a>00867         <span class="keywordflow">if</span> (!<a class="code" href="classMMSFBDev.html#19f9bdfb8e81e276631a89fbab64fb24">activate</a>(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, this-&gt;<a class="code" href="classMMSFBDev.html#65a8bec0b88cf53a5395a00b28952d67" title="name of the device file">device_file</a>, &amp;this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>, width, height, pixelformat)) {
<a name="l00868"></a>00868             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00869"></a>00869         }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871         <span class="comment">// check the result of activation</span>
<a name="l00872"></a>00872         <span class="keywordflow">if</span>    ((width == (<span class="keywordtype">int</span>)this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#f80c0ca49e3418e2e20cc95e4616bb36">xres</a>) &amp;&amp; (height == (<span class="keywordtype">int</span>)this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#c149c05b07bdfa22355dca3cc5a522a7">yres</a>)
<a name="l00873"></a>00873             &amp;&amp; (pixeldef.<a class="code" href="structMMSFBPixelDef.html#00eda3c0b4b64bcdaef1f1addd34db7c">bits</a> == (<span class="keywordtype">int</span>)this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#b2cad096dcc4e5fd543d3b40c24d9e5f">bits_per_pixel</a>)) {
<a name="l00874"></a>00874 
<a name="l00875"></a>00875             printf(<span class="stringliteral">"MMSFBDev: mode successfully switched to %dx%d, pixelformat %s (%d bits), %s\n"</span>,
<a name="l00876"></a>00876                     width, height, <a class="code" href="mmstypes_8h.html#6727c4c364ac2d2ff384ac40cea47b17">getMMSFBPixelFormatString</a>(pixelformat).c_str(), pixeldef.<a class="code" href="structMMSFBPixelDef.html#00eda3c0b4b64bcdaef1f1addd34db7c">bits</a>,
<a name="l00877"></a>00877                     this-&gt;device_file.c_str());
<a name="l00878"></a>00878 
<a name="l00879"></a>00879             <span class="keywordflow">if</span> (backbuffer) {
<a name="l00880"></a>00880                 <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5eba4164bc628e5dc7b1c2591e0101c4">yres_virtual</a> &lt; this-&gt;var_screeninfo.yres * (backbuffer+1)) {
<a name="l00881"></a>00881                     printf(<span class="stringliteral">"MMSFBDev: buffer size %dx%d is to small (%dx%d requested), %s\n"</span>,
<a name="l00882"></a>00882                             this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#51132691fa95f57c448db6af35f0b884">xres_virtual</a>, this-&gt;var_screeninfo.yres_virtual,
<a name="l00883"></a>00883                             this-&gt;var_screeninfo.xres, this-&gt;var_screeninfo.yres * (backbuffer+1),
<a name="l00884"></a>00884                             this-&gt;device_file.c_str());
<a name="l00885"></a>00885                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00886"></a>00886                 }
<a name="l00887"></a>00887             }
<a name="l00888"></a>00888         }
<a name="l00889"></a>00889         <span class="keywordflow">else</span> {
<a name="l00890"></a>00890             printf(<span class="stringliteral">"MMSFBDev: mode switch to %dx%d, pixelformat %s (%d bits) failed, %s\n"</span>,
<a name="l00891"></a>00891                     width, height, <a class="code" href="mmstypes_8h.html#6727c4c364ac2d2ff384ac40cea47b17">getMMSFBPixelFormatString</a>(pixelformat).c_str(), pixeldef.<a class="code" href="structMMSFBPixelDef.html#00eda3c0b4b64bcdaef1f1addd34db7c">bits</a>,
<a name="l00892"></a>00892                     this-&gt;device_file.c_str());
<a name="l00893"></a>00893             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00894"></a>00894         }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896         <span class="comment">// build the pixelformat</span>
<a name="l00897"></a>00897         <span class="keywordflow">if</span> (!<a class="code" href="classMMSFBDev.html#e4e339e84b5d70da214e6ece641f63d0">buildPixelFormat</a>()) {
<a name="l00898"></a>00898             printf(<span class="stringliteral">"MMSFBDev: unsupported pixelformat: r=%d(offs=%d), g=%d(offs=%d), b=%d(offs=%d), a=%d(offs=%d) (%d bit)\n"</span>,
<a name="l00899"></a>00899                     this-&gt;<a class="code" href="classMMSFBDev.html#bd0ea83fb2b9dd091819919fbaf69f19" title="variable screen infos">var_screeninfo</a>.<a class="code" href="structfb__var__screeninfo.html#5dba7c2e5f6997c1c58f61cd4bb7e4bf">red</a>.<a class="code" href="structfb__bitfield.html#7b9b4ceab6e49a86ad17c1f8cd246133">length</a>,    this-&gt;var_screeninfo.red.offset,
<a name="l00900"></a>00900                     this-&gt;var_screeninfo.green.length,  this-&gt;var_screeninfo.green.offset,
<a name="l00901"></a>00901                     this-&gt;var_screeninfo.blue.length,   this-&gt;var_screeninfo.blue.offset,
<a name="l00902"></a>00902                     this-&gt;var_screeninfo.transp.length, this-&gt;var_screeninfo.transp.offset,
<a name="l00903"></a>00903                     this-&gt;var_screeninfo.bits_per_pixel);
<a name="l00904"></a>00904             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00905"></a>00905         }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907         <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].pixelformat != pixelformat) {
<a name="l00908"></a>00908             printf(<span class="stringliteral">"MMSFBDev: pixelformat not correctly set, %s set, %s requested\n"</span>,
<a name="l00909"></a>00909                     <a class="code" href="mmstypes_8h.html#6727c4c364ac2d2ff384ac40cea47b17">getMMSFBPixelFormatString</a>(this-&gt;<a class="code" href="classMMSFBDev.html#0d5120a9b35f5f339a4a60764112c28f" title="layer infos">layers</a>[0].pixelformat).c_str(),
<a name="l00910"></a>00910                     <a class="code" href="mmstypes_8h.html#6727c4c364ac2d2ff384ac40cea47b17">getMMSFBPixelFormatString</a>(pixelformat).c_str());
<a name="l00911"></a>00911             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00912"></a>00912         }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00915"></a>00915     }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 <span class="comment"></span>
<a name="l00920"></a>00920 <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span>
<a name="l00921"></a>00921 <span class="comment"></span>
<a name="l00922"></a><a class="code" href="classMMSFBDev.html#c124e2917e22b76ab38abc5d20ff961b">00922</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#c124e2917e22b76ab38abc5d20ff961b">MMSFBDev::vtOpen</a>(<span class="keywordtype">int</span> console) {
<a name="l00923"></a>00923     <span class="comment">// close the vt device if opened</span>
<a name="l00924"></a>00924     <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l00925"></a>00925 
<a name="l00926"></a>00926     <span class="comment">// run a program in a new session</span>
<a name="l00927"></a>00927     setsid();
<a name="l00928"></a>00928 
<a name="l00929"></a>00929     <span class="comment">// open the tty0 device</span>
<a name="l00930"></a>00930     this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a> = open(<span class="stringliteral">"/dev/tty0"</span>, O_RDONLY | O_NOCTTY);
<a name="l00931"></a>00931     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a> &lt; 0) {
<a name="l00932"></a>00932         <span class="keywordflow">if</span> (errno == ENXIO) {
<a name="l00933"></a>00933             printf(<span class="stringliteral">"MMSFBDev: virtual terminal not available (working without it)\n"</span>);
<a name="l00934"></a>00934             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00935"></a>00935         }
<a name="l00936"></a>00936         <span class="keywordflow">if</span> (errno == ENOENT) {
<a name="l00937"></a>00937             this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a> = open(<span class="stringliteral">"/dev/vc/0"</span>, O_RDONLY | O_NOCTTY);
<a name="l00938"></a>00938             <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a> &lt; 0) {
<a name="l00939"></a>00939                 printf(<span class="stringliteral">"MMSFBDev: opening device /dev/tty0 and /dev/vc/0 failed\n"</span>);
<a name="l00940"></a>00940                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00941"></a>00941             }
<a name="l00942"></a>00942         }
<a name="l00943"></a>00943         <span class="keywordflow">else</span> {
<a name="l00944"></a>00944             printf(<span class="stringliteral">"MMSFBDev: opening device /dev/tty0 failed\n"</span>);
<a name="l00945"></a>00945             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00946"></a>00946         }
<a name="l00947"></a>00947     }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949     <span class="comment">// get the current vt</span>
<a name="l00950"></a>00950     <span class="keyword">struct </span>vt_stat vs;
<a name="l00951"></a>00951     <span class="keywordflow">if</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a>, VT_GETSTATE, &amp;vs) &lt; 0) {
<a name="l00952"></a>00952         printf(<span class="stringliteral">"MMSFBDev: could not get vt state\n"</span>);
<a name="l00953"></a>00953         <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l00954"></a>00954         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00955"></a>00955     }
<a name="l00956"></a>00956     this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#67b552a6eef50151249400b6ddfcf480" title="number of vt from which disko was started">previous</a> = vs.v_active;
<a name="l00957"></a>00957     printf(<span class="stringliteral">"MMSFBDev: started from virtual terminal #%d\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#67b552a6eef50151249400b6ddfcf480" title="number of vt from which disko was started">previous</a>);
<a name="l00958"></a>00958 
<a name="l00959"></a>00959     <span class="keywordflow">if</span> (console &gt;= 0) {
<a name="l00960"></a>00960         this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a> = console;
<a name="l00961"></a>00961     }
<a name="l00962"></a>00962     <span class="keywordflow">else</span> {
<a name="l00963"></a>00963         <span class="comment">// query the vt number which can be used</span>
<a name="l00964"></a>00964         <span class="keywordtype">int</span> n = ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a>, VT_OPENQRY, &amp;this-&gt;vt.number);
<a name="l00965"></a>00965         <span class="keywordflow">if</span> ((n &lt; 0) || (this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a> == -1)) {
<a name="l00966"></a>00966             printf(<span class="stringliteral">"MMSFBDev: query vt number failed\n"</span>);
<a name="l00967"></a>00967             <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l00968"></a>00968             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00969"></a>00969         }
<a name="l00970"></a>00970     }
<a name="l00971"></a>00971     printf(<span class="stringliteral">"MMSFBDev: using virtual terminal #%d\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>);
<a name="l00972"></a>00972 
<a name="l00973"></a>00973     <span class="comment">// save original fb</span>
<a name="l00974"></a>00974     <span class="keyword">struct </span><a class="code" href="structfb__con2fbmap.html">fb_con2fbmap</a> c2f;
<a name="l00975"></a>00975     c2f.<a class="code" href="structfb__con2fbmap.html#2c7aacef94d71a840cc14cabd9a99f68">console</a> = this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>;
<a name="l00976"></a>00976     <span class="keywordflow">if</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="fb_8h.html#d9a0150590f09256c8080da23f789b4e">FBIOGET_CON2FBMAP</a>, &amp;c2f)) {
<a name="l00977"></a>00977         printf(<span class="stringliteral">"MMSFBDev: get original framebuffer failed for vt #%d\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>);
<a name="l00978"></a>00978         <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l00979"></a>00979         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00980"></a>00980     }
<a name="l00981"></a>00981     this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#6724489d2e79fa5f315f5bedcd5eb3e1" title="save original fb">org_fb</a> = c2f.<a class="code" href="structfb__con2fbmap.html#5baf3f5770f145912daf85c747c2e4d0">framebuffer</a>;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     <span class="comment">// set console for our fb</span>
<a name="l00984"></a>00984     <span class="keyword">struct </span>stat fbs;
<a name="l00985"></a>00985     <span class="keywordflow">if</span> (fstat(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, &amp;fbs)) {
<a name="l00986"></a>00986         printf(<span class="stringliteral">"MMSFBDev: stat fb device failed\n"</span>);
<a name="l00987"></a>00987         this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#6724489d2e79fa5f315f5bedcd5eb3e1" title="save original fb">org_fb</a> = -1;
<a name="l00988"></a>00988         <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l00989"></a>00989         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00990"></a>00990     }
<a name="l00991"></a>00991     c2f.<a class="code" href="structfb__con2fbmap.html#5baf3f5770f145912daf85c747c2e4d0">framebuffer</a> = (fbs.st_rdev &amp; 0xFF) &gt;&gt; 5;
<a name="l00992"></a>00992     c2f.<a class="code" href="structfb__con2fbmap.html#2c7aacef94d71a840cc14cabd9a99f68">console</a> = this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>;
<a name="l00993"></a>00993     <span class="keywordflow">if</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="fb_8h.html#f9b19e26b10cb94a17a60a4534b52536">FBIOPUT_CON2FBMAP</a>, &amp;c2f) &lt; 0) {
<a name="l00994"></a>00994         printf(<span class="stringliteral">"MMSFBDev: set console for framebuffer failed\n"</span>);
<a name="l00995"></a>00995         this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#6724489d2e79fa5f315f5bedcd5eb3e1" title="save original fb">org_fb</a> = -1;
<a name="l00996"></a>00996         <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l00997"></a>00997         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00998"></a>00998     }
<a name="l00999"></a>00999 
<a name="l01000"></a>01000     <span class="comment">// switch to our vt</span>
<a name="l01001"></a>01001     <span class="keywordflow">while</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a>, VT_ACTIVATE, this-&gt;vt.number) &lt; 0) {
<a name="l01002"></a>01002         <span class="keywordflow">if</span> (errno == EINTR) <span class="keywordflow">continue</span>;
<a name="l01003"></a>01003         printf(<span class="stringliteral">"MMSFBDev: cannot switch (VT_ACTIVATE) to console #%d\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>);
<a name="l01004"></a>01004         <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l01005"></a>01005         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01006"></a>01006     }
<a name="l01007"></a>01007     <span class="keywordflow">while</span> (ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a>, VT_WAITACTIVE, this-&gt;vt.number) &lt; 0) {
<a name="l01008"></a>01008         <span class="keywordflow">if</span> (errno == EINTR) <span class="keywordflow">continue</span>;
<a name="l01009"></a>01009         printf(<span class="stringliteral">"MMSFBDev: cannot switch (VT_WAITACTIVE) to console #%d\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>);
<a name="l01010"></a>01010         <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l01011"></a>01011         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01012"></a>01012     }
<a name="l01013"></a>01013     usleep(50*1000);
<a name="l01014"></a>01014 
<a name="l01015"></a>01015     <span class="comment">// open my tty device</span>
<a name="l01016"></a>01016     <span class="keywordtype">char</span> tty[16];
<a name="l01017"></a>01017     sprintf(tty, <span class="stringliteral">"/dev/tty%d"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>);
<a name="l01018"></a>01018     this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a> = open(tty, O_RDWR | O_NOCTTY);
<a name="l01019"></a>01019     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a> &lt; 0) {
<a name="l01020"></a>01020         <span class="keywordflow">if</span> (errno == ENOENT) {
<a name="l01021"></a>01021             sprintf(tty, <span class="stringliteral">"/dev/vc/%d"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>);
<a name="l01022"></a>01022             this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a> = open(tty, O_RDWR | O_NOCTTY);
<a name="l01023"></a>01023             <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a> &lt; 0) {
<a name="l01024"></a>01024                 printf(<span class="stringliteral">"MMSFBDev: opening device /dev/tty%d and /dev/vc/%d failed\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>, this-&gt;vt.number);
<a name="l01025"></a>01025                 <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l01026"></a>01026                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01027"></a>01027             }
<a name="l01028"></a>01028         }
<a name="l01029"></a>01029         <span class="keywordflow">else</span> {
<a name="l01030"></a>01030             printf(<span class="stringliteral">"MMSFBDev: opening device /dev/tty%d failed\n"</span>, this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>);
<a name="l01031"></a>01031             <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">vtClose</a>();
<a name="l01032"></a>01032             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01033"></a>01033         }
<a name="l01034"></a>01034     }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036     <span class="comment">// attach to the device</span>
<a name="l01037"></a>01037     ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, TIOCSCTTY, 0);
<a name="l01038"></a>01038 
<a name="l01039"></a>01039     <span class="comment">// switch cursor off</span>
<a name="l01040"></a>01040     <span class="keyword">const</span> <span class="keywordtype">char</span> cursor_off[] = <span class="stringliteral">"\033[?1;0;0c"</span>;
<a name="l01041"></a>01041     write(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, cursor_off, <span class="keyword">sizeof</span>(cursor_off));
<a name="l01042"></a>01042 
<a name="l01043"></a>01043     <span class="comment">// put terminal into graphics mode</span>
<a name="l01044"></a>01044     ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, KDSETMODE, KD_GRAPHICS);
<a name="l01045"></a>01045 
<a name="l01046"></a>01046     <span class="comment">// init keyboard</span>
<a name="l01047"></a>01047     ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, KDSKBMODE, K_MEDIUMRAW);
<a name="l01048"></a>01048     ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, KDSKBLED, 0);
<a name="l01049"></a>01049     tcgetattr(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, &amp;this-&gt;saved_ts);
<a name="l01050"></a>01050     <span class="keyword">struct </span>termios ts;
<a name="l01051"></a>01051     ts = this-&gt;<a class="code" href="classMMSFBDev.html#ae6e2a2a614696e0e096a0a07de4f235" title="saved settings from general terminal interface">saved_ts</a>;
<a name="l01052"></a>01052     ts.c_cc[VTIME] = 0;
<a name="l01053"></a>01053     ts.c_cc[VMIN] = 1;
<a name="l01054"></a>01054     ts.c_lflag &amp;= ~(ICANON|ECHO|ISIG);
<a name="l01055"></a>01055     ts.c_iflag = 0;
<a name="l01056"></a>01056     tcsetattr(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, TCSAFLUSH, &amp;ts);
<a name="l01057"></a>01057     tcsetpgrp(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, getpgrp());
<a name="l01058"></a>01058 
<a name="l01059"></a>01059     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01060"></a>01060 }
<a name="l01061"></a>01061 
<a name="l01062"></a><a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">01062</a> <span class="keywordtype">void</span> <a class="code" href="classMMSFBDev.html#a55d5549dad37658825dbb908c9d885a">MMSFBDev::vtClose</a>() {
<a name="l01063"></a>01063     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a> != -1) {
<a name="l01064"></a>01064         <span class="comment">// close tty</span>
<a name="l01065"></a>01065         tcsetattr(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, TCSAFLUSH, &amp;this-&gt;saved_ts);
<a name="l01066"></a>01066         ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, KDSKBMODE, K_XLATE);
<a name="l01067"></a>01067         ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, KDSETMODE, KD_TEXT);
<a name="l01068"></a>01068         <span class="keyword">const</span> <span class="keywordtype">char</span> cursor_on[] = <span class="stringliteral">"\033[?0;0;0c"</span>;
<a name="l01069"></a>01069         write(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>, cursor_on, <span class="keyword">sizeof</span>(cursor_on));
<a name="l01070"></a>01070         close(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>);
<a name="l01071"></a>01071         this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a> = -1;
<a name="l01072"></a>01072     }
<a name="l01073"></a>01073 
<a name="l01074"></a>01074     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#6724489d2e79fa5f315f5bedcd5eb3e1" title="save original fb">org_fb</a> != -1) {
<a name="l01075"></a>01075         <span class="comment">// reset the fb for used console</span>
<a name="l01076"></a>01076         <span class="keyword">struct </span><a class="code" href="structfb__con2fbmap.html">fb_con2fbmap</a> c2f;
<a name="l01077"></a>01077         c2f.<a class="code" href="structfb__con2fbmap.html#5baf3f5770f145912daf85c747c2e4d0">framebuffer</a> = this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#6724489d2e79fa5f315f5bedcd5eb3e1" title="save original fb">org_fb</a>;
<a name="l01078"></a>01078         c2f.<a class="code" href="structfb__con2fbmap.html#2c7aacef94d71a840cc14cabd9a99f68">console</a> = this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a>;
<a name="l01079"></a>01079         ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>, <a class="code" href="fb_8h.html#f9b19e26b10cb94a17a60a4534b52536">FBIOPUT_CON2FBMAP</a>, &amp;c2f);
<a name="l01080"></a>01080         this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#6724489d2e79fa5f315f5bedcd5eb3e1" title="save original fb">org_fb</a> = -1;
<a name="l01081"></a>01081     }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#67b552a6eef50151249400b6ddfcf480" title="number of vt from which disko was started">previous</a> != -1) {
<a name="l01084"></a>01084         <span class="comment">// switch back to previous vt</span>
<a name="l01085"></a>01085         ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a>, VT_ACTIVATE, this-&gt;vt.previous);
<a name="l01086"></a>01086         ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a>, VT_WAITACTIVE, this-&gt;vt.previous);
<a name="l01087"></a>01087         usleep(50*1000);
<a name="l01088"></a>01088         ioctl(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a>, VT_DISALLOCATE, this-&gt;vt.number);
<a name="l01089"></a>01089         this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#62e64d5db5bfcc46a4c276658edb25a2" title="number of vt where disko is running">number</a> = -1;
<a name="l01090"></a>01090         this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#67b552a6eef50151249400b6ddfcf480" title="number of vt from which disko was started">previous</a> = -1;
<a name="l01091"></a>01091     }
<a name="l01092"></a>01092 
<a name="l01093"></a>01093     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a> != -1) {
<a name="l01094"></a>01094         <span class="comment">// close tty</span>
<a name="l01095"></a>01095         close(this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a>);
<a name="l01096"></a>01096         this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#174db7498c3ec905fdaedc2e93ca1788" title="/dev/tty0 file descriptor">fd0</a> = -1;
<a name="l01097"></a>01097     }
<a name="l01098"></a>01098 }
<a name="l01099"></a>01099 
<a name="l01100"></a><a class="code" href="classMMSFBDev.html#ccf6081c4493b4345f443019cf436f67">01100</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBDev.html#ccf6081c4493b4345f443019cf436f67">MMSFBDev::vtGetFd</a>(<span class="keywordtype">int</span> *<a class="code" href="classMMSFBDev.html#9a53dfb0e77661c1de2217b77c7bb581" title="file descriptor of the framebuffer">fd</a>) {
<a name="l01101"></a>01101     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a> != -1) {
<a name="l01102"></a>01102         *fd = this-&gt;<a class="code" href="classMMSFBDev.html#9fb91a68a9b266a992bf5dbdb9b3e4a4">vt</a>.<a class="code" href="structMMSFBDev_1_1VT.html#962477284fa12224c262888a5977ec41" title="file descriptor of the allocated tty">fd</a>;
<a name="l01103"></a>01103         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01104"></a>01104     }
<a name="l01105"></a>01105     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01106"></a>01106 }
<a name="l01107"></a>01107 
<a name="l01108"></a>01108 <span class="preprocessor">#endif</span>
</pre></div></div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1675780-3");
pageTracker._trackPageview();
</script>

<hr class="footer"/><address class="footer" style="text-align:right;"><small>Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a></small></address>
</body>
</html>
