<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Disko API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);' >
<div id="top">
<div id="titlearea" style="background:#262929;">
  <div id="projectlogo">
    <img alt="Logo" src="./disko-logo.png" style="float:left;"/>
    <br clear="all"/>
  </div>
</div>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="classes.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
<h1>mmsfbmanager.cpp</h1><a href="mmsfbmanager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *   Copyright (C) 2005-2007 Stefan Schwarzer, Jens Schneider,             *</span>
<a name="l00003"></a>00003 <span class="comment"> *                           Matthias Hardt, Guido Madaus                  *</span>
<a name="l00004"></a>00004 <span class="comment"> *                                                                         *</span>
<a name="l00005"></a>00005 <span class="comment"> *   Copyright (C) 2007-2008 BerLinux Solutions GbR                        *</span>
<a name="l00006"></a>00006 <span class="comment"> *                           Stefan Schwarzer &amp; Guido Madaus               *</span>
<a name="l00007"></a>00007 <span class="comment"> *                                                                         *</span>
<a name="l00008"></a>00008 <span class="comment"> *   Copyright (C) 2009-2013 BerLinux Solutions GmbH                       *</span>
<a name="l00009"></a>00009 <span class="comment"> *                                                                         *</span>
<a name="l00010"></a>00010 <span class="comment"> *   Authors:                                                              *</span>
<a name="l00011"></a>00011 <span class="comment"> *      Stefan Schwarzer   &lt;stefan.schwarzer@diskohq.org&gt;,                 *</span>
<a name="l00012"></a>00012 <span class="comment"> *      Matthias Hardt     &lt;matthias.hardt@diskohq.org&gt;,                   *</span>
<a name="l00013"></a>00013 <span class="comment"> *      Jens Schneider     &lt;jens.schneider@diskohq.org&gt;,                   *</span>
<a name="l00014"></a>00014 <span class="comment"> *      Guido Madaus       &lt;guido.madaus@diskohq.org&gt;,                     *</span>
<a name="l00015"></a>00015 <span class="comment"> *      Patrick Helterhoff &lt;patrick.helterhoff@diskohq.org&gt;,               *</span>
<a name="l00016"></a>00016 <span class="comment"> *      René Bählkow       &lt;rene.baehlkow@diskohq.org&gt;                     *</span>
<a name="l00017"></a>00017 <span class="comment"> *                                                                         *</span>
<a name="l00018"></a>00018 <span class="comment"> *   This library is free software; you can redistribute it and/or         *</span>
<a name="l00019"></a>00019 <span class="comment"> *   modify it under the terms of the GNU Lesser General Public            *</span>
<a name="l00020"></a>00020 <span class="comment"> *   License version 2.1 as published by the Free Software Foundation.     *</span>
<a name="l00021"></a>00021 <span class="comment"> *                                                                         *</span>
<a name="l00022"></a>00022 <span class="comment"> *   This library is distributed in the hope that it will be useful,       *</span>
<a name="l00023"></a>00023 <span class="comment"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *</span>
<a name="l00024"></a>00024 <span class="comment"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU     *</span>
<a name="l00025"></a>00025 <span class="comment"> *   Lesser General Public License for more details.                       *</span>
<a name="l00026"></a>00026 <span class="comment"> *                                                                         *</span>
<a name="l00027"></a>00027 <span class="comment"> *   You should have received a copy of the GNU Lesser General Public      *</span>
<a name="l00028"></a>00028 <span class="comment"> *   License along with this library; if not, write to the                 *</span>
<a name="l00029"></a>00029 <span class="comment"> *   Free Software Foundation, Inc.,                                       *</span>
<a name="l00030"></a>00030 <span class="comment"> *   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA            *</span>
<a name="l00031"></a>00031 <span class="comment"> **************************************************************************/</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="mmsfbmanager_8h.html">mmsgui/mmsfbmanager.h</a>"</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include "<a class="code" href="mmsfbsurfacemanager_8h.html">mmsgui/fb/mmsfbsurfacemanager.h</a>"</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#ifdef __HAVE_XRANDR__</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include &lt;X11/extensions/Xrandr.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#endif</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <a class="code" href="mmserror_8h.html#02305d35408e1ff3dbe4474a222c6a94" title="Macro which defines a new error type.">MMS_CREATEERROR</a>(MMSFBManagerError);
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="comment">/* initialize the mmsfbmanager object */</span>
<a name="l00045"></a><a class="code" href="mmsfbmanager_8cpp.html#f877077f9a7834955ae76f161e6471ef">00045</a> <a class="code" href="classMMSFBManager.html">MMSFBManager</a> <a class="code" href="mmsfbmanager_8h.html#f877077f9a7834955ae76f161e6471ef">mmsfbmanager</a>;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">/* exit handler routine */</span>
<a name="l00048"></a><a class="code" href="mmsfbmanager_8cpp.html#15a4f6bc79eedbdbb009fe6cd8959b86">00048</a> <span class="keywordtype">void</span> <a class="code" href="mmsfbmanager_8cpp.html#15a4f6bc79eedbdbb009fe6cd8959b86">mmsfbmanager_onexit</a>(<span class="keywordtype">int</span> num, <span class="keywordtype">void</span> *arg) {
<a name="l00049"></a>00049     <a class="code" href="classMMSFBManager.html">MMSFBManager</a> *o=(<a class="code" href="classMMSFBManager.html">MMSFBManager</a>*)arg;
<a name="l00050"></a>00050     o-&gt;<a class="code" href="classMMSFBManager.html#b033a44564721000fe82b987814426d1">release</a>();
<a name="l00051"></a>00051 }
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="classMMSFBManager.html#7613e1708fe96a12994a9eeed61a4ea1">00053</a> <a class="code" href="classMMSFBManager.html#7613e1708fe96a12994a9eeed61a4ea1">MMSFBManager::MMSFBManager</a>() {
<a name="l00054"></a>00054     <span class="comment">// init me</span>
<a name="l00055"></a>00055     this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a> = NULL;
<a name="l00056"></a>00056     this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a> = NULL;
<a name="l00057"></a>00057     this-&gt;<a class="code" href="classMMSFBManager.html#ac23862bf42ce3145b320a977f398624" title="id of the osd layer, in one layer mode it is equal to video layer id">graphicslayerid</a> = -1;
<a name="l00058"></a>00058     this-&gt;<a class="code" href="classMMSFBManager.html#ebdaed57c2f7fcd51f927b8addd8c1b9" title="id of the video layer, in one layer mode it is equal to osd layer id">videolayerid</a> = -1;
<a name="l00059"></a>00059     this-&gt;<a class="code" href="classMMSFBManager.html#783b6f8f66ff6d1065e9f4d41545f3a5" title="number of layers">layercount</a> = 0;
<a name="l00060"></a>00060 }
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="classMMSFBManager.html#9099f61cf194aa40cbde692807610f68">00062</a> <a class="code" href="classMMSFBManager.html#9099f61cf194aa40cbde692807610f68">MMSFBManager::~MMSFBManager</a>() {
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="classMMSFBManager.html#3961fb3f8035dfec98b8f81da41dbc3d">00065</a> <span class="keywordtype">bool</span> <a class="code" href="classMMSFBManager.html#3961fb3f8035dfec98b8f81da41dbc3d">MMSFBManager::init</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv, <span class="keywordtype">string</span> appl_name, <span class="keywordtype">string</span> appl_icon_name,
<a name="l00066"></a>00066                         <span class="keywordtype">bool</span> <a class="code" href="classMMSFBManager.html#f5c519ea2843973178a4dcc38e98f695" title="have to open a virtual console?">virtual_console</a>, <span class="keywordtype">bool</span> flip_flush) {
<a name="l00067"></a>00067     <span class="keywordtype">int</span> myargc=argc;
<a name="l00068"></a>00068     <span class="keywordtype">char</span> *myargv[255];
<a name="l00069"></a>00069     <span class="keywordtype">int</span> i;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071     <span class="comment">// save virtual console state</span>
<a name="l00072"></a>00072     this-&gt;virtual_console = virtual_console;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074     <span class="comment">// per default we have one layer</span>
<a name="l00075"></a>00075     this-&gt;<a class="code" href="classMMSFBManager.html#783b6f8f66ff6d1065e9f4d41545f3a5" title="number of layers">layercount</a> = 1;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <span class="keywordflow">for</span>(i=0;i&lt;argc;i++)
<a name="l00078"></a>00078         myargv[i]=strdup(argv[i]);
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"init mmsfb"</span>);
<a name="l00081"></a>00081     <span class="keywordtype">bool</span> ea = <a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#e94bf618a769072e7b8a3ac37c52f550">getExtendedAccel</a>();
<a name="l00082"></a>00082 <span class="preprocessor">#ifdef  __HAVE_DIRECTFB__</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#8b7e36792251c55f5ab65180b37e4bb7">getAllocMethod</a>() == <span class="stringliteral">"DFB"</span>) {
<a name="l00084"></a>00084         <span class="comment">// use dfb even if extended accel</span>
<a name="l00085"></a>00085         ea = <span class="keyword">false</span>;
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087 <span class="preprocessor">#endif</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a>00089     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#7ae4563cb932019de0b3a29ea463c5f0">getRotateScreen</a>() == 180) {
<a name="l00090"></a>00090         <span class="comment">// set rotate by 180° flag</span>
<a name="l00091"></a>00091         <a class="code" href="mmsfbbase_8h.html#a309fbac080a70785769c0a65a1b7e16">MMSFBBase_rotate180</a> = <span class="keyword">true</span>;
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     <span class="comment">// get layer settings from config</span>
<a name="l00095"></a>00095     <a class="code" href="classMMSConfigDataLayer.html">MMSConfigDataLayer</a> videolayer_conf = this-&gt;<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#810adcbf0d8f27460f1041ff43788a93">getVideoLayer</a>();
<a name="l00096"></a>00096     <a class="code" href="classMMSConfigDataLayer.html">MMSConfigDataLayer</a> graphicslayer_conf = this-&gt;<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#7b3c72c6a56a09a922bcc5cec28d5821">getGraphicsLayer</a>();
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="preprocessor">#ifdef  __HAVE_DIRECTFB__</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(videolayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1ae4094900932e1e6f85263aa39056e8">outputtype</a> == <a class="code" href="mmstypes_8h.html#11da2eb092aa41a86336a64622d740b47d16685d94c1d7eb8725e44efbec14d3" title="X11 (backend: DFB and X11).">MMSFB_OT_X11</a>) {
<a name="l00100"></a>00100         myargv[myargc++] = strdup(<span class="stringliteral">"--dfb:system=x11"</span>);
<a name="l00101"></a>00101         <span class="keywordtype">char</span> mode[24];
<a name="l00102"></a>00102         snprintf(mode, 24, <span class="stringliteral">"--dfb:mode=%dx%d"</span>, graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>.<a class="code" href="classMMSFBRectangle.html#6d149724642ea0b33ce3152a5a5499a5" title="width">w</a>, graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>.<a class="code" href="classMMSFBRectangle.html#80e92abd0c1a7a9a67f5fde757a080ad" title="height">h</a>);
<a name="l00103"></a>00103         myargv[myargc++] = strdup(mode);
<a name="l00104"></a>00104     }
<a name="l00105"></a>00105 <span class="preprocessor">#endif</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>
<a name="l00107"></a>00107     <span class="comment">// init the MMSFB class</span>
<a name="l00108"></a>00108     <span class="keywordflow">if</span> (!<a class="code" href="mmsfb_8h.html#a1513ce6000f5760ddd9613e0cdffb04">mmsfb</a>-&gt;<a class="code" href="classMMSFB.html#bdb78930b2459ec89eee317fba70702f">init</a>(myargc, myargv, <a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#1f12d7d16e5f33a864cbcabacaced760">getBackend</a>(), graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>,
<a name="l00109"></a>00109                      ea, <a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#c10eae03106eaf80a4e5b653d3c568a5">getFullScreen</a>(), <a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#0fdba332f4050b864bc4164ef30307ea">getPointer</a>(), appl_name, appl_icon_name, <a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#1b4461d87c6bb2eb5ea1844179f29e1f">getHideApplication</a>())) {
<a name="l00110"></a>00110         <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"init mmsfb failed!"</span>);
<a name="l00111"></a>00111         <span class="keywordflow">throw</span> MMSFBManagerError(0, <a class="code" href="mmsfbbase_8h.html#6e4bce4b8ba4b8cfe462338d35cd31ee">MMSFB_LastErrorString</a>);
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"get video layer"</span>);
<a name="l00115"></a>00115     <span class="keywordflow">if</span> (!<a class="code" href="mmsfb_8h.html#a1513ce6000f5760ddd9613e0cdffb04">mmsfb</a>-&gt;<a class="code" href="classMMSFB.html#f6b25a18906101fcc83a279938a74cb2">getLayer</a>(videolayer_conf.<a class="code" href="classMMSConfigDataLayer.html#73a74091cf99c085e41b9a9235c6c9f7">id</a>, &amp;this-&gt;videolayer, videolayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1ae4094900932e1e6f85263aa39056e8">outputtype</a>, this-&gt;virtual_console))
<a name="l00116"></a>00116         <span class="keywordflow">throw</span> MMSFBManagerError(0, <a class="code" href="mmsfbbase_8h.html#6e4bce4b8ba4b8cfe462338d35cd31ee">MMSFB_LastErrorString</a>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <span class="keywordflow">if</span> (videolayer_conf.<a class="code" href="classMMSConfigDataLayer.html#73a74091cf99c085e41b9a9235c6c9f7">id</a> == graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#73a74091cf99c085e41b9a9235c6c9f7">id</a>) {
<a name="l00119"></a>00119         <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"video layer and graphics layer are the same"</span>);
<a name="l00120"></a>00120         this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a> = this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122         <span class="keywordflow">if</span> (!flip_flush)
<a name="l00123"></a>00123             this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#b6ae52d1799b8054e055bdd784a485a1">setFlipFlags</a>(<a class="code" href="mmsfbbase_8h.html#24603080ce959d994a6b8f6029337479" title="surface flip flag: flip upon the next vertical sync">MMSFB_FLIP_ONSYNC</a>);
<a name="l00124"></a>00124         <span class="keywordflow">else</span>
<a name="l00125"></a>00125             this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#b6ae52d1799b8054e055bdd784a485a1">setFlipFlags</a>(<a class="code" href="mmsfbbase_8h.html#24603080ce959d994a6b8f6029337479" title="surface flip flag: flip upon the next vertical sync">MMSFB_FLIP_ONSYNC</a> | <a class="code" href="mmsfbbase_8h.html#6f7fa5332e048fc97c2ce4cfa484a3bf" title="surface flip flag: send pan event to fbdev every time the display buffer has changed...">MMSFB_FLIP_FLUSH</a>);
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127     <span class="keywordflow">else</span> {
<a name="l00128"></a>00128         this-&gt;<a class="code" href="classMMSFBManager.html#783b6f8f66ff6d1065e9f4d41545f3a5" title="number of layers">layercount</a>++;
<a name="l00129"></a>00129         <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"get graphics layer"</span>);
<a name="l00130"></a>00130         <span class="keywordflow">if</span> (!<a class="code" href="mmsfb_8h.html#a1513ce6000f5760ddd9613e0cdffb04">mmsfb</a>-&gt;<a class="code" href="classMMSFB.html#f6b25a18906101fcc83a279938a74cb2">getLayer</a>(graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#73a74091cf99c085e41b9a9235c6c9f7">id</a>, &amp;this-&gt;graphicslayer, graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1ae4094900932e1e6f85263aa39056e8">outputtype</a>, <span class="keyword">false</span>))
<a name="l00131"></a>00131             <span class="keywordflow">throw</span> MMSFBManagerError(0, <a class="code" href="mmsfbbase_8h.html#6e4bce4b8ba4b8cfe462338d35cd31ee">MMSFB_LastErrorString</a>);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133         <span class="keywordflow">if</span> (!flip_flush)
<a name="l00134"></a>00134             this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#b6ae52d1799b8054e055bdd784a485a1">setFlipFlags</a>(<a class="code" href="mmsfbbase_8h.html#24603080ce959d994a6b8f6029337479" title="surface flip flag: flip upon the next vertical sync">MMSFB_FLIP_ONSYNC</a>);
<a name="l00135"></a>00135         <span class="keywordflow">else</span>
<a name="l00136"></a>00136             this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#b6ae52d1799b8054e055bdd784a485a1">setFlipFlags</a>(<a class="code" href="mmsfbbase_8h.html#24603080ce959d994a6b8f6029337479" title="surface flip flag: flip upon the next vertical sync">MMSFB_FLIP_ONSYNC</a> | <a class="code" href="mmsfbbase_8h.html#6f7fa5332e048fc97c2ce4cfa484a3bf" title="surface flip flag: send pan event to fbdev every time the display buffer has changed...">MMSFB_FLIP_FLUSH</a>);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <span class="keywordflow">if</span> (videolayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1ae4094900932e1e6f85263aa39056e8">outputtype</a> == <a class="code" href="mmstypes_8h.html#11da2eb092aa41a86336a64622d740b46d0697e2f8dfc16fdcf8713c2c27fae1" title="MATROXFB (backend: DFB and FBDEV).">MMSFB_OT_MATROXFB</a>)
<a name="l00139"></a>00139             this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#b6ae52d1799b8054e055bdd784a485a1">setFlipFlags</a>(<a class="code" href="mmsfbbase_8h.html#2d61480c42e3e2a3e6d8bb62d66b1544" title="surface flip flag: WAIT and ONSYNC">MMSFB_FLIP_WAITFORSYNC</a>);
<a name="l00140"></a>00140         <span class="keywordflow">else</span>
<a name="l00141"></a>00141             this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#b6ae52d1799b8054e055bdd784a485a1">setFlipFlags</a>(<a class="code" href="mmsfbbase_8h.html#24603080ce959d994a6b8f6029337479" title="surface flip flag: flip upon the next vertical sync">MMSFB_FLIP_ONSYNC</a>);
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#818e6a5428a64f2d9b69dce2fc07af86">getID</a>(&amp;this-&gt;graphicslayerid))
<a name="l00145"></a>00145         <span class="keywordflow">throw</span> MMSFBManagerError(0, <a class="code" href="mmsfbbase_8h.html#6e4bce4b8ba4b8cfe462338d35cd31ee">MMSFB_LastErrorString</a>);
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#818e6a5428a64f2d9b69dce2fc07af86">getID</a>(&amp;this-&gt;videolayerid))
<a name="l00148"></a>00148         <span class="keywordflow">throw</span> MMSFBManagerError(0, <a class="code" href="mmsfbbase_8h.html#6e4bce4b8ba4b8cfe462338d35cd31ee">MMSFB_LastErrorString</a>);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <span class="comment">/* set on exit handler */</span>
<a name="l00151"></a>00151     <a class="code" href="mmsinit_8cpp.html#24a4f341ea41c2eb708abd59f9fd7ba4">on_exit</a>(<a class="code" href="mmsfbmanager_8cpp.html#15a4f6bc79eedbdbb009fe6cd8959b86">mmsfbmanager_onexit</a>, <span class="keyword">this</span>);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a><a class="code" href="classMMSFBManager.html#b033a44564721000fe82b987814426d1">00156</a> <span class="keywordtype">void</span> <a class="code" href="classMMSFBManager.html#b033a44564721000fe82b987814426d1">MMSFBManager::release</a>() {
<a name="l00157"></a>00157     <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"release mmsfb"</span>);
<a name="l00158"></a>00158     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a>)
<a name="l00159"></a>00159         <span class="keyword">delete</span> this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a>;
<a name="l00160"></a>00160     <a class="code" href="mmsfb_8h.html#a1513ce6000f5760ddd9613e0cdffb04">mmsfb</a>-&gt;<a class="code" href="classMMSFB.html#1b3fdf5371ea8fe64841fa872ed3239a">release</a>();
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="classMMSFBManager.html#0f20001933990d6c5931135990f6c8ef">00163</a> <span class="keywordtype">void</span> <a class="code" href="classMMSFBManager.html#0f20001933990d6c5931135990f6c8ef">MMSFBManager::applySettings</a>() {
<a name="l00164"></a>00164     <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"configure graphics layer"</span>);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166     <span class="comment">// get layer settings from config</span>
<a name="l00167"></a>00167     <a class="code" href="classMMSConfigDataLayer.html">MMSConfigDataLayer</a> videolayer_conf = this-&gt;<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#810adcbf0d8f27460f1041ff43788a93">getVideoLayer</a>();
<a name="l00168"></a>00168     <a class="code" href="classMMSConfigDataLayer.html">MMSConfigDataLayer</a> graphicslayer_conf = this-&gt;<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#7b3c72c6a56a09a922bcc5cec28d5821">getGraphicsLayer</a>();
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="comment">// get the window pixelformat</span>
<a name="l00171"></a>00171     <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb" title="supported pixel formats">MMSFBSurfacePixelFormat</a> window_pixelformat = <a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#5d22f80f925286aa61c310bd9e370839">getGraphicsWindowPixelformat</a>();
<a name="l00172"></a>00172     <span class="keywordflow">switch</span> (window_pixelformat) {
<a name="l00173"></a>00173     <span class="keywordflow">case</span> <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bba716d7315027968d1f6f7db7e3ba9257" title="32 bit ARGB (4 byte, alpha 8@24, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_ARGB</a>:
<a name="l00174"></a>00174     <span class="keywordflow">case</span> <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb5aaa64869bed62bc2ec6df15e0e206a9" title="32 bit ARGB (4 byte, inv. alpha 8@24, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_AiRGB</a>:
<a name="l00175"></a>00175     <span class="keywordflow">case</span> <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbe954e3199f813395edab4d17d5ce7f78" title="32 bit AYUV (4 byte, alpha 8@24, Y 8@16, Cb 8@8, Cr 8@0)">MMSFB_PF_AYUV</a>:
<a name="l00176"></a>00176     <span class="keywordflow">case</span> <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb6bc362ceccc5664f0b4d1cdf594dbd24" title="16 bit ARGB (2 byte, alpha 4@12, red 4@8, green 4@4, blue 4@0)">MMSFB_PF_ARGB4444</a>:
<a name="l00177"></a>00177     <span class="keywordflow">case</span> <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbf2dcc7252d01244bb0310acbeebac065" title="16 bit RGB (2 byte, red 5@11, green 6@5, blue 5@0)">MMSFB_PF_RGB16</a>:
<a name="l00178"></a>00178         <span class="keywordflow">break</span>;
<a name="l00179"></a>00179     <span class="keywordflow">default</span>:
<a name="l00180"></a>00180         <span class="comment">// window pixelformat not set or unsupported, use the layer pixelformat</span>
<a name="l00181"></a>00181         window_pixelformat = graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#05c68c82bd2c17400ed51eaa4af6e2a0">pixelformat</a>;
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (!<a class="code" href="mmsfbbase_8h.html#702b5a871ee27148c23e08820252998b">isAlphaPixelFormat</a>(window_pixelformat)) {
<a name="l00183"></a>00183             <span class="comment">// the gui internally needs surfaces with alpha channel</span>
<a name="l00184"></a>00184             <span class="comment">// now we have to decide if we are working in RGB or YUV color space</span>
<a name="l00185"></a>00185             <span class="keywordflow">if</span> (!<a class="code" href="mmsfbbase_8h.html#65b1b7226f5eb26f372646bac27f2095">isRGBPixelFormat</a>(window_pixelformat))
<a name="l00186"></a>00186                 <span class="comment">// so switch all non-alpha pixelformats to AYUV</span>
<a name="l00187"></a>00187                 window_pixelformat = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbe954e3199f813395edab4d17d5ce7f78" title="32 bit AYUV (4 byte, alpha 8@24, Y 8@16, Cb 8@8, Cr 8@0)">MMSFB_PF_AYUV</a>;
<a name="l00188"></a>00188             <span class="keywordflow">else</span>
<a name="l00189"></a>00189                 <span class="comment">// so switch all non-alpha pixelformats to ARGB</span>
<a name="l00190"></a>00190                 window_pixelformat = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bba716d7315027968d1f6f7db7e3ba9257" title="32 bit ARGB (4 byte, alpha 8@24, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_ARGB</a>;
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192         <span class="keywordflow">else</span>
<a name="l00193"></a>00193         <span class="keywordflow">if</span> (<a class="code" href="mmsfbbase_8h.html#9e5371944eaf5ece8e2c85ac08887017">isIndexedPixelFormat</a>(window_pixelformat)) {
<a name="l00194"></a>00194             <span class="comment">// the gui internally needs non-indexed surfaces</span>
<a name="l00195"></a>00195             <span class="comment">// so switch all indexed pixelformats to ARGB</span>
<a name="l00196"></a>00196             window_pixelformat = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bba716d7315027968d1f6f7db7e3ba9257" title="32 bit ARGB (4 byte, alpha 8@24, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_ARGB</a>;
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198         <span class="keywordflow">break</span>;
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <span class="comment">// get the surface pixelformat</span>
<a name="l00202"></a>00202     <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb" title="supported pixel formats">MMSFBSurfacePixelFormat</a> surface_pixelformat = <a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#1751b87abae85f24fdde2dd5ff110294">getGraphicsSurfacePixelformat</a>();
<a name="l00203"></a>00203     <span class="keywordflow">switch</span> (surface_pixelformat) {
<a name="l00204"></a>00204     <span class="keywordflow">case</span> <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bba716d7315027968d1f6f7db7e3ba9257" title="32 bit ARGB (4 byte, alpha 8@24, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_ARGB</a>:
<a name="l00205"></a>00205     <span class="keywordflow">case</span> <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb5aaa64869bed62bc2ec6df15e0e206a9" title="32 bit ARGB (4 byte, inv. alpha 8@24, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_AiRGB</a>:
<a name="l00206"></a>00206     <span class="keywordflow">case</span> <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbe954e3199f813395edab4d17d5ce7f78" title="32 bit AYUV (4 byte, alpha 8@24, Y 8@16, Cb 8@8, Cr 8@0)">MMSFB_PF_AYUV</a>:
<a name="l00207"></a>00207     <span class="keywordflow">case</span> <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bb6bc362ceccc5664f0b4d1cdf594dbd24" title="16 bit ARGB (2 byte, alpha 4@12, red 4@8, green 4@4, blue 4@0)">MMSFB_PF_ARGB4444</a>:
<a name="l00208"></a>00208     <span class="keywordflow">case</span> <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbf2dcc7252d01244bb0310acbeebac065" title="16 bit RGB (2 byte, red 5@11, green 6@5, blue 5@0)">MMSFB_PF_RGB16</a>:
<a name="l00209"></a>00209         <span class="keywordflow">break</span>;
<a name="l00210"></a>00210     <span class="keywordflow">default</span>:
<a name="l00211"></a>00211         <span class="comment">// surface pixelformat not set or unsupported, use the layer pixelformat</span>
<a name="l00212"></a>00212         surface_pixelformat = graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#05c68c82bd2c17400ed51eaa4af6e2a0">pixelformat</a>;
<a name="l00213"></a>00213         <span class="keywordflow">if</span> (!<a class="code" href="mmsfbbase_8h.html#702b5a871ee27148c23e08820252998b">isAlphaPixelFormat</a>(surface_pixelformat)) {
<a name="l00214"></a>00214             <span class="comment">// the gui internally needs surfaces with alpha channel</span>
<a name="l00215"></a>00215             <span class="comment">// now we have to decide if we are working in RGB or YUV color space</span>
<a name="l00216"></a>00216             <span class="keywordflow">if</span> (!<a class="code" href="mmsfbbase_8h.html#65b1b7226f5eb26f372646bac27f2095">isRGBPixelFormat</a>(surface_pixelformat))
<a name="l00217"></a>00217                 <span class="comment">// so switch all non-alpha pixelformats to AYUV</span>
<a name="l00218"></a>00218                 surface_pixelformat = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bbe954e3199f813395edab4d17d5ce7f78" title="32 bit AYUV (4 byte, alpha 8@24, Y 8@16, Cb 8@8, Cr 8@0)">MMSFB_PF_AYUV</a>;
<a name="l00219"></a>00219             <span class="keywordflow">else</span>
<a name="l00220"></a>00220                 <span class="comment">// so switch all non-alpha pixelformats to ARGB</span>
<a name="l00221"></a>00221                 surface_pixelformat = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bba716d7315027968d1f6f7db7e3ba9257" title="32 bit ARGB (4 byte, alpha 8@24, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_ARGB</a>;
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223         <span class="keywordflow">else</span>
<a name="l00224"></a>00224         <span class="keywordflow">if</span> (<a class="code" href="mmsfbbase_8h.html#9e5371944eaf5ece8e2c85ac08887017">isIndexedPixelFormat</a>(surface_pixelformat)) {
<a name="l00225"></a>00225             <span class="comment">// the gui internally needs non-indexed surfaces</span>
<a name="l00226"></a>00226             <span class="comment">// so switch all indexed pixelformats to ARGB</span>
<a name="l00227"></a>00227             surface_pixelformat = <a class="code" href="mmstypes_8h.html#f8e305495dc796efb337f7a1e84692bba716d7315027968d1f6f7db7e3ba9257" title="32 bit ARGB (4 byte, alpha 8@24, red 8@16, green 8@8, blue 8@0)">MMSFB_PF_ARGB</a>;
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229         <span class="keywordflow">break</span>;
<a name="l00230"></a>00230     }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="comment">// set exclusive access to the graphics layer</span>
<a name="l00233"></a>00233     <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"set exclusive access"</span>);
<a name="l00234"></a>00234     <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#75be90030a13fc4514d523f36239f506">setExclusiveAccess</a>())
<a name="l00235"></a>00235         <span class="keywordflow">throw</span> MMSFBManagerError(0, <a class="code" href="mmsfbbase_8h.html#6e4bce4b8ba4b8cfe462338d35cd31ee">MMSFB_LastErrorString</a>);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"set configuration"</span>);
<a name="l00238"></a>00238     <span class="keywordflow">if</span>(!this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#1430e38b761397124884f21e15e2c7f7">setConfiguration</a>(graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>.<a class="code" href="classMMSFBRectangle.html#6d149724642ea0b33ce3152a5a5499a5" title="width">w</a>, graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>.<a class="code" href="classMMSFBRectangle.html#80e92abd0c1a7a9a67f5fde757a080ad" title="height">h</a>,
<a name="l00239"></a>00239                                                graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#05c68c82bd2c17400ed51eaa4af6e2a0">pixelformat</a>,
<a name="l00240"></a>00240                                                graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#428c6bd79ef48fdc8510685f4d3348b0">buffermode</a>,
<a name="l00241"></a>00241                                                graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#4c51cced6045f03a7e0fcf4f87c046fc">options</a>,
<a name="l00242"></a>00242                                                window_pixelformat,
<a name="l00243"></a>00243                                                surface_pixelformat))
<a name="l00244"></a>00244         <span class="keywordflow">throw</span> MMSFBManagerError(0, <a class="code" href="mmsfbbase_8h.html#6e4bce4b8ba4b8cfe462338d35cd31ee">MMSFB_LastErrorString</a>);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="preprocessor">#ifdef __HAVE_XRANDR__</span>
<a name="l00247"></a>00247 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#1f12d7d16e5f33a864cbcabacaced760">getBackend</a>() == <a class="code" href="mmstypes_8h.html#b454e1dfe6bece1334978c43ff70f12ffd7b0fd220c55b7bfc323f9c51f70859" title="X11 backend from disko framework.">MMSFB_BE_X11</a> &amp;&amp; <a class="code" href="mmsfbbase_8h.html#a309fbac080a70785769c0a65a1b7e16">MMSFBBase_rotate180</a>) {
<a name="l00248"></a>00248         <a class="code" href="structX11__IMPL.html">X11_IMPL</a> *impl = (<a class="code" href="structX11__IMPL.html">X11_IMPL</a>*)this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#5e9170c31e45604421d8acb91c6cd0de">getImplementation</a>();
<a name="l00249"></a>00249         
<a name="l00250"></a>00250         <span class="comment">/* check for RandR extension */</span>
<a name="l00251"></a>00251         <span class="keywordtype">int</span> event_base, error_base;
<a name="l00252"></a>00252         <span class="keywordflow">if</span> (!XRRQueryExtension (impl-&gt;<a class="code" href="structX11__IMPL.html#31012a6a44290d3d4c813ea0aaca7f09">x_display</a>, &amp;event_base, &amp;error_base)) {
<a name="l00253"></a>00253             fprintf(stderr, <span class="stringliteral">"RandR extension missing: Rotation not supported\n"</span>);
<a name="l00254"></a>00254         } <span class="keywordflow">else</span> {
<a name="l00255"></a>00255             Window root = DefaultRootWindow(impl-&gt;<a class="code" href="structX11__IMPL.html#31012a6a44290d3d4c813ea0aaca7f09">x_display</a>);
<a name="l00256"></a>00256             XRRScreenConfiguration *sc = XRRGetScreenInfo(impl-&gt;<a class="code" href="structX11__IMPL.html#31012a6a44290d3d4c813ea0aaca7f09">x_display</a>, root);
<a name="l00257"></a>00257             <span class="keywordflow">if</span>(sc) {
<a name="l00258"></a>00258                 Rotation rot = RR_Rotate_0;
<a name="l00259"></a>00259                 SizeID size = XRRConfigCurrentConfiguration(sc, &amp;rot);
<a name="l00260"></a>00260                 <span class="keywordflow">if</span>(rot != RR_Rotate_180) {
<a name="l00261"></a>00261                     XRRSetScreenConfig(impl-&gt;<a class="code" href="structX11__IMPL.html#31012a6a44290d3d4c813ea0aaca7f09">x_display</a>, sc, root, size, RR_Rotate_180, CurrentTime);
<a name="l00262"></a>00262                 }
<a name="l00263"></a>00263                 <a class="code" href="mmsfbbase_8h.html#a309fbac080a70785769c0a65a1b7e16">MMSFBBase_rotate180</a> = <span class="keyword">false</span>;
<a name="l00264"></a>00264             }
<a name="l00265"></a>00265         }       
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 <span class="preprocessor">#endif</span>
<a name="l00268"></a>00268 <span class="preprocessor"></span>
<a name="l00269"></a>00269     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBManager.html#ebdaed57c2f7fcd51f927b8addd8c1b9" title="id of the video layer, in one layer mode it is equal to osd layer id">videolayerid</a> != this-&gt;<a class="code" href="classMMSFBManager.html#ac23862bf42ce3145b320a977f398624" title="id of the osd layer, in one layer mode it is equal to video layer id">graphicslayerid</a>) {
<a name="l00270"></a>00270 <span class="preprocessor">#ifdef  __HAVE_DIRECTFB__</span>
<a name="l00271"></a>00271 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#1f12d7d16e5f33a864cbcabacaced760">getBackend</a>() == <a class="code" href="mmstypes_8h.html#b454e1dfe6bece1334978c43ff70f12ffd7b0fd220c55b7bfc323f9c51f70859" title="X11 backend from disko framework.">MMSFB_BE_X11</a>) {
<a name="l00272"></a>00272             <span class="comment">//give a little time to window routines</span>
<a name="l00273"></a>00273             usleep(300000);
<a name="l00274"></a>00274         }
<a name="l00275"></a>00275 <span class="preprocessor">#endif</span>
<a name="l00276"></a>00276 <span class="preprocessor"></span>
<a name="l00277"></a>00277         <span class="comment">// use both layers</span>
<a name="l00278"></a>00278         <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"configure video layer"</span>);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"set exclusive access"</span>);
<a name="l00281"></a>00281         <span class="comment">// set exclusive access to the video layer</span>
<a name="l00282"></a>00282         <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#75be90030a13fc4514d523f36239f506">setExclusiveAccess</a>())
<a name="l00283"></a>00283             <span class="keywordflow">throw</span> MMSFBManagerError(0, <a class="code" href="mmsfbbase_8h.html#6e4bce4b8ba4b8cfe462338d35cd31ee">MMSFB_LastErrorString</a>);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285         <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"set configuration"</span>);
<a name="l00286"></a>00286         <span class="comment">// set video layer's config</span>
<a name="l00287"></a>00287         <span class="keywordflow">if</span> (!this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#1430e38b761397124884f21e15e2c7f7">setConfiguration</a>(videolayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>.<a class="code" href="classMMSFBRectangle.html#6d149724642ea0b33ce3152a5a5499a5" title="width">w</a>, videolayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>.<a class="code" href="classMMSFBRectangle.html#80e92abd0c1a7a9a67f5fde757a080ad" title="height">h</a>,
<a name="l00288"></a>00288                                                 videolayer_conf.<a class="code" href="classMMSConfigDataLayer.html#05c68c82bd2c17400ed51eaa4af6e2a0">pixelformat</a>,
<a name="l00289"></a>00289                                                 videolayer_conf.<a class="code" href="classMMSConfigDataLayer.html#428c6bd79ef48fdc8510685f4d3348b0">buffermode</a>,
<a name="l00290"></a>00290                                                 videolayer_conf.<a class="code" href="classMMSConfigDataLayer.html#4c51cced6045f03a7e0fcf4f87c046fc">options</a>))
<a name="l00291"></a>00291             <span class="keywordflow">throw</span> MMSFBManagerError(0, <a class="code" href="mmsfbbase_8h.html#6e4bce4b8ba4b8cfe462338d35cd31ee">MMSFB_LastErrorString</a>);
<a name="l00292"></a>00292         <span class="comment">//this-&gt;videolayer-&gt;dfblayer-&gt;SetFieldParity(this-&gt;videolayer-&gt;dfblayer,0);</span>
<a name="l00293"></a>00293 
<a name="l00294"></a>00294         <span class="comment">// set the full opacity of the graphics layer</span>
<a name="l00295"></a>00295         this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#5ae3ee13a7315cb647cace18d8543740">setOpacity</a>(0);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         <span class="keywordflow">if</span> (graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1ae4094900932e1e6f85263aa39056e8">outputtype</a> == <a class="code" href="mmstypes_8h.html#11da2eb092aa41a86336a64622d740b466e0037b55e1e5ccc258756d6cac09ad" title="VIAFB (backend: DFB).">MMSFB_OT_VIAFB</a>) {
<a name="l00298"></a>00298             <span class="comment">// set the video layer behind the graphics layer</span>
<a name="l00299"></a>00299             <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"set the video layer behind the graphics layer"</span>);
<a name="l00300"></a>00300             this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#ac67ee650868be2b2f7486a1d4a2608c">setLevel</a>(-1);
<a name="l00301"></a>00301         }
<a name="l00302"></a>00302         <span class="keywordflow">else</span>
<a name="l00303"></a>00303         <span class="keywordflow">if</span> (graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1ae4094900932e1e6f85263aa39056e8">outputtype</a> == <a class="code" href="mmstypes_8h.html#11da2eb092aa41a86336a64622d740b4a809ab2c05842982dedd2ee28931435d" title="XSHM (backend: X11).">MMSFB_OT_XSHM</a>) {
<a name="l00304"></a>00304             <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"set the video layer behind the graphics layer"</span>);
<a name="l00305"></a>00305             this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#ac67ee650868be2b2f7486a1d4a2608c">setLevel</a>(+1);
<a name="l00306"></a>00306         }
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309     <span class="comment">// set global surface attributes</span>
<a name="l00310"></a>00310     <span class="keywordtype">string</span> buffermode = graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#428c6bd79ef48fdc8510685f4d3348b0">buffermode</a>;
<a name="l00311"></a>00311     <a class="code" href="classMMSFBSurface.html" title="This class describes a surface.">MMSFBSurface</a> *gls;
<a name="l00312"></a>00312     <span class="keywordflow">if</span> (this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>-&gt;<a class="code" href="classMMSFBLayer.html#8470ea56c159ba867da70f5b864a2511">getSurface</a>(&amp;gls, this-&gt;virtual_console)) {
<a name="l00313"></a>00313         <span class="comment">// set the static extended accel flag</span>
<a name="l00314"></a>00314         gls-&gt;<a class="code" href="classMMSFBSurface.html#5a1719cf733f5b1b2ed7fa1607187f2a">setExtendedAcceleration</a>(<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#e94bf618a769072e7b8a3ac37c52f550">getExtendedAccel</a>());
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="comment">// set the global alloc method (default is malloc)</span>
<a name="l00317"></a>00317         <span class="keywordflow">if</span> (<a class="code" href="mmsfb_8h.html#a1513ce6000f5760ddd9613e0cdffb04">mmsfb</a>-&gt;<a class="code" href="classMMSFB.html#a141eae19b4be0bde896f42f92507e52">getBackend</a>() == <a class="code" href="mmstypes_8h.html#b454e1dfe6bece1334978c43ff70f12f81c9bc2add3d80b2a362f2a86a6c0427" title="directfb backend">MMSFB_BE_DFB</a>) {
<a name="l00318"></a>00318 <span class="preprocessor">#ifdef  __HAVE_DIRECTFB__</span>
<a name="l00319"></a>00319 <span class="preprocessor"></span>            <span class="keywordtype">string</span> am = <a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#8b7e36792251c55f5ab65180b37e4bb7">getAllocMethod</a>();
<a name="l00320"></a>00320             <span class="keywordflow">if</span> (am == <span class="stringliteral">"MALLOC"</span>) {
<a name="l00321"></a>00321                 <span class="keywordflow">if</span> (!<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#e94bf618a769072e7b8a3ac37c52f550">getExtendedAccel</a>())
<a name="l00322"></a>00322                     gls-&gt;<a class="code" href="classMMSFBSurface.html#a259b909a7ee97c8bfef4429d959fcdb">setAllocMethod</a>(<a class="code" href="mmsfbsurface_8h.html#30be2ea497630fcb31b760fdfca47ef2a43744f3372e0ef8e4643def8e00abf7" title="using directfb surfaces">MMSFBSurfaceAllocMethod_dfb</a>);
<a name="l00323"></a>00323             }
<a name="l00324"></a>00324             <span class="keywordflow">else</span>
<a name="l00325"></a>00325                 gls-&gt;<a class="code" href="classMMSFBSurface.html#a259b909a7ee97c8bfef4429d959fcdb">setAllocMethod</a>(<a class="code" href="mmsfbsurface_8h.html#30be2ea497630fcb31b760fdfca47ef2a43744f3372e0ef8e4643def8e00abf7" title="using directfb surfaces">MMSFBSurfaceAllocMethod_dfb</a>);
<a name="l00326"></a>00326 <span class="preprocessor">#endif</span>
<a name="l00327"></a>00327 <span class="preprocessor"></span>        }
<a name="l00328"></a>00328         <span class="keywordflow">else</span>
<a name="l00329"></a>00329         <span class="keywordflow">if</span> (graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1ae4094900932e1e6f85263aa39056e8">outputtype</a> == <a class="code" href="mmstypes_8h.html#11da2eb092aa41a86336a64622d740b424d78aa178247b7962984bce3a985090" title="OGL (backend: X11 and FBDEV).">MMSFB_OT_OGL</a>) {
<a name="l00330"></a>00330             gls-&gt;<a class="code" href="classMMSFBSurface.html#a259b909a7ee97c8bfef4429d959fcdb">setAllocMethod</a>(<a class="code" href="mmsfbsurface_8h.html#30be2ea497630fcb31b760fdfca47ef2fe04723e29ecfa016402ca31a46465a1" title="using opengl surfaces">MMSFBSurfaceAllocMethod_ogl</a>);
<a name="l00331"></a>00331         }
<a name="l00332"></a>00332     }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="comment">// init the mmsfbwindowmanager</span>
<a name="l00335"></a>00335     <a class="code" href="mmsfbwindowmanager_8h.html#e38ca9bbeec7d7918015ecc7645dce8c">mmsfbwindowmanager</a>-&gt;<a class="code" href="classMMSFBWindowManager.html#afd67609991ee7c7c7e9326c50003ddf">init</a>(this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>, (<a class="code" href="classMMSFBManager.html#bbfb89de43d3f050d8d232b9082f2b7e" title="access to the config data">config</a>.<a class="code" href="classMMSConfigData.html#0fdba332f4050b864bc4164ef30307ea">getPointer</a>()==<a class="code" href="mmstypes_8h.html#9aa883b6135754b63e0957974aa7603dd011840673dd3b9970e29dac7d02a8f4" title="enabled, using internal mouse pointer">MMSFB_PM_TRUE</a>));
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     <a class="code" href="tools_8h.html#6662ba34e6d2be8c023dd6f0d0cfe717">DEBUGMSG</a>(<span class="stringliteral">"MMSGUI"</span>, <span class="stringliteral">"creating temporary surface: %dx%d, %s"</span>, graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>.<a class="code" href="classMMSFBRectangle.html#6d149724642ea0b33ce3152a5a5499a5" title="width">w</a>, graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>.<a class="code" href="classMMSFBRectangle.html#80e92abd0c1a7a9a67f5fde757a080ad" title="height">h</a>, <a class="code" href="mmstypes_8h.html#6727c4c364ac2d2ff384ac40cea47b17">getMMSFBPixelFormatString</a>(surface_pixelformat).c_str());
<a name="l00338"></a>00338     <a class="code" href="mmsfbsurfacemanager_8h.html#6de2e3290de91cfc64dc16887e15d25d">mmsfbsurfacemanager</a>-&gt;<a class="code" href="classMMSFBSurfaceManager.html#70a990aee54c23c5b34bb29426f842a2">createTemporarySurface</a>(graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>.<a class="code" href="classMMSFBRectangle.html#6d149724642ea0b33ce3152a5a5499a5" title="width">w</a>, graphicslayer_conf.<a class="code" href="classMMSConfigDataLayer.html#1beae05be8538f74aa4079f48b09b446">rect</a>.<a class="code" href="classMMSFBRectangle.html#80e92abd0c1a7a9a67f5fde757a080ad" title="height">h</a>, surface_pixelformat, (buffermode == <a class="code" href="mmsfbbase_8h.html#fc0de717e64175ed2191cd55044aeb92" title="buffer mode: backbuffer in system memory">MMSFB_BM_BACKSYSTEM</a>));
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341 
<a name="l00342"></a><a class="code" href="classMMSFBManager.html#a14ee62238e0077aa337a8e1baa2648b">00342</a> <a class="code" href="classMMSFBLayer.html" title="This class describes a display layer.">MMSFBLayer</a> *<a class="code" href="classMMSFBManager.html#a14ee62238e0077aa337a8e1baa2648b">MMSFBManager::getVideoLayer</a>() {
<a name="l00343"></a>00343     <span class="keywordflow">return</span> this-&gt;<a class="code" href="classMMSFBManager.html#2de9ff8d84862ad47143dc5fcd05bea9" title="video layer">videolayer</a>;
<a name="l00344"></a>00344 }
<a name="l00345"></a>00345 
<a name="l00346"></a><a class="code" href="classMMSFBManager.html#f4b3d5214cb61bc8cd9f7b8fa4751825">00346</a> <a class="code" href="classMMSFBLayer.html" title="This class describes a display layer.">MMSFBLayer</a> *<a class="code" href="classMMSFBManager.html#f4b3d5214cb61bc8cd9f7b8fa4751825">MMSFBManager::getGraphicsLayer</a>() {
<a name="l00347"></a>00347     <span class="keywordflow">return</span> this-&gt;<a class="code" href="classMMSFBManager.html#edf73f8d598e5ac785dc67e5c1b69c75" title="osd layer">graphicslayer</a>;
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00350"></a><a class="code" href="classMMSFBManager.html#f6fd2e32f098eb8d598717943d746984">00350</a> <span class="keywordtype">int</span> <a class="code" href="classMMSFBManager.html#f6fd2e32f098eb8d598717943d746984">MMSFBManager::getLayerCount</a>() {
<a name="l00351"></a>00351     <span class="keywordflow">return</span> this-&gt;<a class="code" href="classMMSFBManager.html#783b6f8f66ff6d1065e9f4d41545f3a5" title="number of layers">layercount</a>;
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 
</pre></div></div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-1675780-3");
pageTracker._trackPageview();
</script>

<hr class="footer"/><address class="footer" style="text-align:right;"><small>Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a></small></address>
</body>
</html>
